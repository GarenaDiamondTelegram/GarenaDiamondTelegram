<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>–ò–≥—Ä–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <style>
        .device-frame {
            position: relative;
            background: #000;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }
        
        /* –ú–æ–±–∏–ª—å–Ω–∞—è —Ä–∞–º–∫–∞ */
        .mobile-frame {
            width: 390px;
            height: 844px;
            border-radius: 40px;
            padding: 20px;
        }
        
        /* –ö–æ–º–ø—å—é—Ç–µ—Ä–Ω–∞—è —Ä–∞–º–∫–∞ */
        .desktop-frame {
            width: 1200px;
            height: 800px;
            border-radius: 12px;
            padding: 15px;
            background: linear-gradient(145deg, #2d2d2d, #1a1a1a);
        }
        
        .device-screen {
            width: 100%;
            height: 100%;
            background: #1a1a1a;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .mobile-screen {
            border-radius: 20px;
        }
        
        .desktop-screen {
            border-radius: 8px;
            background: linear-gradient(145deg, #1a1a1a, #2d2d2d);
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 420px) {
            .mobile-frame {
                width: 95vw;
                height: 90vh;
                padding: 10px;
            }
        }
        
        @media (max-width: 768px) {
            .desktop-frame {
                width: 95vw;
                height: 90vh;
                padding: 10px;
            }
        }
        /* –≠–ª–µ–º–µ–Ω—Ç—ã –º–æ–±–∏–ª—å–Ω–æ–π —Ä–∞–º–∫–∏ */
        .mobile-frame::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 5px;
            background: #333;
            border-radius: 5px;
        }
        .mobile-frame::after {
            content: '';
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 40px;
            background: #333;
            border-radius: 50%;
            border: 2px solid #555;
        }
        
        /* –≠–ª–µ–º–µ–Ω—Ç—ã –¥–µ—Å–∫—Ç–æ–ø–Ω–æ–π —Ä–∞–º–∫–∏ */
        .desktop-frame::before {
            content: '';
            position: absolute;
            top: 5px;
            left: 5px;
            right: 5px;
            height: 25px;
            background: #333;
            border-radius: 8px 8px 0 0;
            display: flex;
            align-items: center;
            padding: 0 10px;
        }
        
        .desktop-frame::after {
            content: '‚óè ‚óè ‚óè';
            position: absolute;
            top: 12px;
            left: 15px;
            color: #666;
            font-size: 12px;
            letter-spacing: 5px;
        }
        .diamond-panel {
            background: #2d3748;
            padding: 4px 8px;
            border-radius: 12px;
        }
        .notification-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background: #dc2626;
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 12px;
            line-height: 1;
        }
        .enter-animation {
            animation: enterAnimation 0.5s ease-in-out forwards;
        }
        .exit-animation {
            animation: exitAnimation 0.5s ease-in-out forwards;
        }
        .notifications-slide-down {
            animation: slideDown 0.5s ease-in-out forwards;
        }
        .notifications-slide-up {
            animation: slideUp 0.5s ease-in-out forwards;
        }
        .active-tab {
            background: #2563eb !important;
        }
        .vip-user {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: bold;
        }
        .booster-active {
            border: 2px solid #10b981;
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
        }
        @keyframes enterAnimation {
            0% { transform: scale(1) translate(0, 0); opacity: 1; }
            100% { transform: scale(0.2) translate(-100px, -100px); opacity: 0; }
        }
        @keyframes exitAnimation {
            0% { transform: scale(0.2) translate(-100px, -100px); opacity: 0; }
            100% { transform: scale(1) translate(0, 0); opacity: 1; }
        }
        @keyframes slideDown {
            0% { transform: translateY(-100%); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        @keyframes slideUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-100%); opacity: 0; }
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
    </style>
  </head>
  <body class="bg-gray-900 text-white flex items-center justify-center min-h-screen w-screen overflow-x-hidden">
      <div id="device-container" class="device-frame">
          <div id="device-screen" class="device-screen">
              <div id="app" class="w-full p-4 sm:p-6">
                <!-- Loading Screen -->
                <div id="loading-screen" class="flex flex-col items-center justify-center h-screen">
                    <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-blue-500"></div>
                    <p class="mt-4 text-lg">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                </div>

                <!-- Registration Screen -->
                <div id="registration-screen" class="hidden flex-col space-y-4">
                    <h1 class="text-2xl font-bold text-center">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h1>
                    <input id="phone" type="tel" placeholder="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞" class="w-full p-2 bg-gray-800 rounded text-white text-base">
                    <input id="email" type="email" placeholder="–ü–æ—á—Ç–∞" class="w-full p-2 bg-gray-800 rounded text-white text-base">
                    <input id="ff-id" type="text" placeholder="Free Fire ID" class="w-full p-2 bg-gray-800 rounded text-white text-base">
                    <input id="password" type="password" placeholder="–ü–∞—Ä–æ–ª—å" class="w-full p-2 bg-gray-800 rounded text-white text-base">
                    <button id="register-btn" class="w-full p-2 bg-blue-600 rounded hover:bg-blue-700">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                </div>

                <!-- Main Menu -->
                <div id="main-menu" class="hidden flex-col space-y-4">
                    <div class="flex justify-between items-center">
                        <div class="flex space-x-2">
                            <button id="profile-btn" class="p-2 bg-gray-800 rounded-full hover:bg-gray-700">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                </svg>
                            </button>
                            <button id="notifications-btn" class="relative p-2 bg-gray-800 rounded-full hover:bg-gray-700">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6 6 0 00-12 0v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                                </svg>
                                <span id="notification-badge" class="notification-badge hidden">0</span>
                            </button>
                        </div>
                        <div class="diamond-panel">
                            <p id="diamond-balance" class="text-lg">0.0000 üíé</p>
                        </div>
                    </div>
                    <button id="farm-btn" class="w-full p-2 bg-green-600 rounded hover:bg-green-700">–§–∞—Ä–º–∏—Ç—å üíé</button>
                    <button id="guild-btn" class="w-full p-2 bg-purple-600 rounded hover:bg-purple-700">–ì–∏–ª—å–¥–∏—è</button>
                    <button id="shop-btn" class="w-full p-2 bg-yellow-600 rounded hover:bg-yellow-700">üõí –ú–∞–≥–∞–∑–∏–Ω</button>
                    <button id="leaderboard-btn" class="w-full p-2 bg-blue-500 rounded hover:bg-blue-600">üèÜ –†–µ–π—Ç–∏–Ω–≥</button>

                    <button id="admin-btn" class="w-full p-2 bg-red-600 rounded hover:bg-red-700 hidden">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</button>
                </div>

                <!-- Farming Screen -->
                <div id="farm-screen" class="hidden flex-col space-y-4">
                    <h1 class="text-2xl font-bold text-center">–§–∞—Ä–º üíé</h1>
                    <p id="diamond-count" class="text-lg text-center">0.0000 üíé</p>
                    <p id="tap-count" class="text-lg text-center">–¢–∞–ø—ã: 0/100</p>
                    <p id="cooldown" class="text-lg text-center hidden">–û—Å—Ç–∞–ª–æ—Å—å: 4—á 00–º 00—Å</p>
                    <button id="tap-btn" class="w-32 h-32 mx-auto bg-gray-800 rounded-full flex justify-center items-center">
                        <img id="tap-image" src="https://i.ibb.co/B5McMybk/Chat-GPT-Image-24-2025-04-14-46.png" alt="Garena Logo" class="h-24 w-24 object-contain">
                    </button>
                    <button id="back-btn" class="w-full p-2 bg-blue-600 rounded hover:bg-blue-700">–ù–∞–∑–∞–¥</button>
                </div>

                <!-- Profile Screen -->
                <div id="profile-screen" class="hidden flex-col space-y-4">
                    <h1 class="text-2xl font-bold text-center">–ü—Ä–æ—Ñ–∏–ª—å</h1>
                    
                    <!-- Player Stats -->
                    <div class="bg-gray-800 p-4 rounded-lg space-y-2">
                        <p id="profile-username" class="text-lg font-bold"></p>
                        <p id="profile-energy" class="text-sm"></p>
                        <p id="profile-diamonds" class="text-lg"></p>
                        <p id="profile-total-stats" class="text-sm text-gray-400"></p>
                        <p id="profile-vip-status" class="text-sm"></p>
                    </div>
                    
                    <!-- Account Info -->
                    <div class="bg-gray-800 p-4 rounded-lg space-y-2">
                        <h3 class="text-lg font-bold">–î–∞–Ω–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç–∞</h3>
                        <p id="profile-phone" class="text-sm"></p>
                        <p id="profile-email" class="text-sm"></p>
                        <p id="profile-ff-id" class="text-sm"></p>
                        <p id="profile-password" class="text-sm"></p>
                    </div>
                    
                    <!-- Active Boosters -->
                    <div id="profile-boosters" class="bg-green-800 p-4 rounded-lg space-y-2 hidden">
                        <h3 class="text-lg font-bold">üöÄ –ê–∫—Ç–∏–≤–Ω—ã–µ –±—É—Å—Ç–µ—Ä—ã</h3>
                        <div id="active-boosters-list"></div>
                    </div>
                    
                    <button id="delete-account-btn" class="w-full p-2 bg-red-600 rounded hover:bg-red-700">–£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
                    <button id="profile-back-btn" class="w-full p-2 bg-blue-600 rounded hover:bg-blue-700">–ù–∞–∑–∞–¥</button>
                </div>

                <!-- Notifications Screen -->
                <div id="notifications-screen" class="hidden flex-col space-y-4">
                    <h1 class="text-2xl font-bold text-center">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h1>
                    <div id="notifications-list" class="flex-col space-y-2"></div>
                    <button id="clear-notifications-btn" class="w-full p-2 bg-red-600 rounded hover:bg-red-700">–û—á–∏—Å—Ç–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</button>
                    <button id="notifications-back-btn" class="w-full p-2 bg-blue-600 rounded hover:bg-blue-700">–ù–∞–∑–∞–¥</button>
                </div>

                <!-- Guild Screen -->
                <div id="guild-screen" class="hidden flex-col space-y-4">
                    <h1 class="text-2xl font-bold text-center">–ì–∏–ª—å–¥–∏—è</h1>
                    <p id="guild-status" class="text-lg text-center"></p>
                    <div id="create-guild-section" class="flex-col space-y-2">
                        <input id="guild-name" type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≥–∏–ª—å–¥–∏–∏" class="w-full p-2 bg-gray-800 rounded text-white text-base">
                        <button id="create-guild-btn" class="w-full p-2 bg-purple-600 rounded hover:bg-purple-700">–°–æ–∑–¥–∞—Ç—å –≥–∏–ª—å–¥–∏—é (10 üíé)</button>
                    </div>
                    <div id="join-guild-section" class="flex-col space-y-2">
                        <select id="guild-select" class="w-full p-2 bg-gray-800 rounded text-white text-base"></select>
                        <button id="join-guild-btn" class="w-full p-2 bg-blue-600 rounded hover:bg-blue-700">–ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É</button>
                    </div>
                    <button id="guild-members-btn" class="w-full p-2 bg-gray-600 rounded hover:bg-gray-700">–£—á–∞—Å—Ç–Ω–∏–∫–∏</button>
                    <button id="leave-guild-btn" class="w-full p-2 bg-red-600 rounded hover:bg-red-700 hidden">–ü–æ–∫–∏–Ω—É—Ç—å –≥–∏–ª—å–¥–∏—é</button>
                    <button id="disband-guild-btn" class="w-full p-2 bg-red-600 rounded hover:bg-red-700 hidden">–†–∞—Å–ø—É—Å—Ç–∏—Ç—å –≥–∏–ª—å–¥–∏—é</button>
                    <button id="guild-requests-btn" class="w-full p-2 bg-blue-600 rounded hover:bg-blue-700 hidden">–ó–∞—è–≤–∫–∏ –Ω–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ</button>
                    <button id="guild-back-btn" class="w-full p-2 bg-blue-600 rounded hover:bg-blue-700">–ù–∞–∑–∞–¥</button>
                </div>

                <!-- Guild Members Screen -->
                <div id="guild-members-screen" class="hidden flex-col space-y-4">
                    <h1 class="text-2xl font-bold text-center">–£—á–∞—Å—Ç–Ω–∏–∫–∏ –≥–∏–ª—å–¥–∏–∏</h1>
                    <div id="guild-members-list" class="flex-col space-y-2"></div>
                    <button id="members-back-btn" class="w-full p-2 bg-blue-600 rounded hover:bg-blue-700">–ù–∞–∑–∞–¥</button>
                </div>

                <!-- Guild Requests Screen -->
                <div id="guild-requests-screen" class="hidden flex-col space-y-4">
                    <h1 class="text-2xl font-bold text-center">–ó–∞—è–≤–∫–∏ –Ω–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ</h1>
                    <div id="guild-requests-list" class="flex-col space-y-2"></div>
                    <button id="requests-back-btn" class="w-full p-2 bg-blue-600 rounded hover:bg-blue-700">–ù–∞–∑–∞–¥</button>
                </div>

                <!-- Shop Screen -->
                <div id="shop-screen" class="hidden flex-col space-y-4">
                    <h1 class="text-2xl font-bold text-center">üõí –ú–∞–≥–∞–∑–∏–Ω</h1>
                    <div class="diamond-panel">
                        <p id="shop-diamond-balance" class="text-lg text-center">0.0000 üíé</p>
                    </div>
                    
                    <!-- Booster Section -->
                    <div class="bg-gray-800 p-4 rounded-lg">
                        <h2 class="text-xl font-bold mb-3 text-center">‚ö° –ë—É—Å—Ç–µ—Ä—ã</h2>
                        <div class="grid grid-cols-2 gap-3">
                            <div class="bg-gray-700 p-3 rounded text-center">
                                <div class="text-2xl mb-2">üöÄ</div>
                                <p class="text-sm mb-2">x2 –°–∫–æ—Ä–æ—Å—Ç—å —Ç–∞–ø–æ–≤</p>
                                <p class="text-xs mb-2">30 –º–∏–Ω—É—Ç</p>
                                <button class="buy-booster-btn w-full p-1 bg-blue-600 rounded text-sm" data-type="speed" data-price="100" data-currency="stars">100 ‚≠ê</button>
                            </div>
                            <div class="bg-gray-700 p-3 rounded text-center">
                                <div class="text-2xl mb-2">üíé</div>
                                <p class="text-sm mb-2">x3 –ê–ª–º–∞–∑—ã</p>
                                <p class="text-xs mb-2">1 —á–∞—Å</p>
                                <button class="buy-booster-btn w-full p-1 bg-green-600 rounded text-sm" data-type="diamonds" data-price="200" data-currency="stars">200 ‚≠ê</button>
                            </div>
                            <div class="bg-gray-700 p-3 rounded text-center">
                                <div class="text-2xl mb-2">‚ö°</div>
                                <p class="text-sm mb-2">+50 –¢–∞–ø–æ–≤</p>
                                <p class="text-xs mb-2">–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ</p>
                                <button class="buy-booster-btn w-full p-1 bg-yellow-600 rounded text-sm" data-type="taps" data-price="0.1" data-currency="ton">0.1 TON</button>
                            </div>
                            <div class="bg-gray-700 p-3 rounded text-center">
                                <div class="text-2xl mb-2">üî•</div>
                                <p class="text-sm mb-2">–ú–µ–≥–∞ –±—É—Å—Ç</p>
                                <p class="text-xs mb-2">x5 –≤—Å–µ –Ω–∞ 2—á</p>
                                <button class="buy-booster-btn w-full p-1 bg-red-600 rounded text-sm" data-type="mega" data-price="0.5" data-currency="ton">0.5 TON</button>
                            </div>
                        </div>
                    </div>

                    <!-- Premium Section -->
                    <div class="bg-gradient-to-r from-yellow-600 to-yellow-800 p-4 rounded-lg">
                        <h2 class="text-xl font-bold mb-3 text-center">üëë –ü—Ä–µ–º–∏—É–º</h2>
                        <div class="space-y-3">
                            <div class="bg-black bg-opacity-30 p-3 rounded">
                                <p class="text-sm mb-2">VIP —Å—Ç–∞—Ç—É—Å (30 –¥–Ω–µ–π)</p>
                                <ul class="text-xs space-y-1 mb-3">
                                    <li>‚Ä¢ x2 –∫ –∞–ª–º–∞–∑–∞–º –Ω–∞–≤—Å–µ–≥–¥–∞</li>
                                    <li>‚Ä¢ +100 —ç–Ω–µ—Ä–≥–∏–∏</li>
                                    <li>‚Ä¢ –≠–∫—Å–∫–ª—é–∑–∏–≤–Ω–∞—è –∏–∫–æ–Ω–∫–∞</li>
                                    <li>‚Ä¢ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤ –≥–∏–ª—å–¥–∏—è—Ö</li>
                                </ul>
                                <button class="buy-premium-btn w-full p-2 bg-yellow-500 rounded text-black font-bold" data-type="vip" data-price="2" data-currency="ton">2 TON</button>
                            </div>
                        </div>
                    </div>

                    <button id="shop-back-btn" class="w-full p-2 bg-blue-600 rounded hover:bg-blue-700">–ù–∞–∑–∞–¥</button>
                </div>

                <!-- Leaderboard Screen -->
                <div id="leaderboard-screen" class="hidden flex-col space-y-4">
                    <h1 class="text-2xl font-bold text-center">üèÜ –†–µ–π—Ç–∏–Ω–≥ –∏–≥—Ä–æ–∫–æ–≤</h1>
                    
                    <!-- Current User Position -->
                    <div id="user-position" class="bg-gradient-to-r from-blue-600 to-blue-800 p-3 rounded-lg">
                        <h3 class="text-lg font-bold mb-2 text-center">–í–∞—à–∞ –ø–æ–∑–∏—Ü–∏—è</h3>
                        <div id="current-user-rank" class="flex justify-between items-center">
                            <div class="flex items-center space-x-2">
                                <span class="text-lg font-bold" id="user-rank-number">#-</span>
                                <span id="user-rank-name">-</span>
                            </div>
                            <div class="text-right">
                                <div class="text-sm" id="user-rank-diamonds">- üíé</div>
                            </div>
                        </div>
                    </div>

                    <!-- Top 20 Players -->
                    <div class="bg-gray-800 p-3 rounded">
                        <h3 class="text-lg font-bold mb-2 text-center">üëë –¢–æ–ø 20 –∏–≥—Ä–æ–∫–æ–≤</h3>
                        <div id="leaderboard-list" class="space-y-2"></div>
                    </div>

                    <div class="text-center text-sm text-gray-400">
                        –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
                    </div>

                    <button id="leaderboard-back-btn" class="w-full p-2 bg-blue-600 rounded hover:bg-blue-700">–ù–∞–∑–∞–¥</button>
                </div>



                <!-- Admin Panel Main Screen -->
                <div id="admin-panel" class="hidden flex-col space-y-4">
                    <h1 class="text-2xl font-bold text-center">üîß –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
                    
                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                    <div class="bg-gray-800 p-4 rounded-lg">
                        <h3 class="text-lg font-bold mb-2">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: <span id="admin-users-count">0</span></div>
                            <div>–ì–∏–ª—å–¥–∏–π: <span id="admin-guilds-count">0</span></div>
                            <div>–û–Ω–ª–∞–π–Ω: <span id="admin-online-count">0</span></div>
                            <div>VIP: <span id="admin-vip-count">0</span></div>
                        </div>
                    </div>
                    
                    <button id="admin-broadcast-btn" class="w-full p-2 bg-green-600 rounded hover:bg-green-700">üì¢ –†–∞—Å—Å—ã–ª–∫–∞</button>
                    <button id="admin-users-btn" class="w-full p-2 bg-blue-600 rounded hover:bg-blue-700">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
                    <button id="admin-guilds-btn" class="w-full p-2 bg-purple-600 rounded hover:bg-purple-700">üè∞ –ì–∏–ª—å–¥–∏–∏</button>
                    <button id="admin-analytics-btn" class="w-full p-2 bg-yellow-600 rounded hover:bg-yellow-700">üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
                    <button id="admin-settings-btn" class="w-full p-2 bg-gray-600 rounded hover:bg-gray-700">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                    <button id="clear-db-btn" class="w-full p-2 bg-red-600 rounded hover:bg-red-700">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ë–î</button>
                    <button id="admin-back-btn" class="w-full p-2 bg-blue-600 rounded hover:bg-blue-700">‚Üê –ù–∞–∑–∞–¥</button>
                </div>

                <!-- Admin Broadcast Screen -->
                <div id="admin-broadcast-screen" class="hidden flex-col space-y-4">
                    <h1 class="text-2xl font-bold text-center">üì¢ –†–∞—Å—Å—ã–ª–∫–∞</h1>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm mb-2">–¢–∏–ø —Ä–∞—Å—Å—ã–ª–∫–∏:</label>
                            <select id="broadcast-type" class="w-full p-2 bg-gray-800 rounded text-white">
                                <option value="all">–í—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º</option>
                                <option value="vip">–¢–æ–ª—å–∫–æ VIP</option>
                                <option value="level">–ü–æ —É—Ä–æ–≤–Ω—é</option>
                                <option value="guild">–£—á–∞—Å—Ç–Ω–∏–∫–∞–º –≥–∏–ª—å–¥–∏–π</option>
                            </select>
                        </div>
                        
                        <div id="broadcast-level-filter" class="hidden">
                            <label class="block text-sm mb-2">–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å:</label>
                            <input type="number" id="broadcast-min-level" min="1" value="1" class="w-full p-2 bg-gray-800 rounded text-white">
                        </div>
                        
                        <div>
                            <label class="block text-sm mb-2">–ó–∞–≥–æ–ª–æ–≤–æ–∫:</label>
                            <input type="text" id="broadcast-title" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è" class="w-full p-2 bg-gray-800 rounded text-white">
                        </div>
                        
                        <div>
                            <label class="block text-sm mb-2">–°–æ–æ–±—â–µ–Ω–∏–µ:</label>
                            <textarea id="broadcast-message" placeholder="–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è..." rows="4" class="w-full p-2 bg-gray-800 rounded text-white"></textarea>
                        </div>
                        
                        <div class="flex space-x-2">
                            <button id="send-broadcast-btn" class="flex-1 p-2 bg-green-600 rounded hover:bg-green-700">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                            <button id="preview-broadcast-btn" class="flex-1 p-2 bg-blue-600 rounded hover:bg-blue-700">üëÅÔ∏è –ü—Ä–µ–≤—å—é</button>
                        </div>
                    </div>
                    
                    <button id="broadcast-back-btn" class="w-full p-2 bg-blue-600 rounded hover:bg-blue-700">‚Üê –ù–∞–∑–∞–¥</button>
                </div>

                <!-- Admin Analytics Screen -->
                <div id="admin-analytics-screen" class="hidden flex-col space-y-4">
                    <h1 class="text-2xl font-bold text-center">üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h1>
                    
                    <div class="grid grid-cols-1 gap-4">
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <h3 class="text-lg font-bold mb-2">üíé –ê–ª–º–∞–∑—ã</h3>
                            <div class="space-y-1 text-sm">
                                <div>–í—Å–µ–≥–æ –¥–æ–±—ã—Ç–æ: <span id="total-diamonds">0</span> üíé</div>
                                <div>–°—Ä–µ–¥–Ω–µ–µ –Ω–∞ –∏–≥—Ä–æ–∫–∞: <span id="avg-diamonds">0</span> üíé</div>
                                <div>–ú–∞–∫—Å–∏–º—É–º —É –∏–≥—Ä–æ–∫–∞: <span id="max-diamonds">0</span> üíé</div>
                            </div>
                        </div>
                        
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <h3 class="text-lg font-bold mb-2">üéØ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h3>
                            <div class="space-y-1 text-sm">
                                <div>–í—Å–µ–≥–æ —Ç–∞–ø–æ–≤: <span id="total-taps">0</span></div>
                                <div>–°—Ä–µ–¥–Ω–µ–µ –Ω–∞ –∏–≥—Ä–æ–∫–∞: <span id="avg-taps">0</span></div>
                                <div>–ê–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ–≥–æ–¥–Ω—è: <span id="active-today">0</span></div>
                            </div>
                        </div>
                        
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <h3 class="text-lg font-bold mb-2">üíé –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∞–ª–º–∞–∑–∞–º</h3>
                            <div id="level-distribution" class="space-y-1 text-sm"></div>
                        </div>
                    </div>
                    
                    <button id="analytics-back-btn" class="w-full p-2 bg-blue-600 rounded hover:bg-blue-700">‚Üê –ù–∞–∑–∞–¥</button>
                </div>

                <!-- Admin Settings Screen -->
                <div id="admin-settings-screen" class="hidden flex-col space-y-4">
                    <h1 class="text-2xl font-bold text-center">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h1>
                    
                    <div class="space-y-4">
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <h3 class="text-lg font-bold mb-2">üéÆ –ò–≥—Ä–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h3>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm mb-1">–ë–∞–∑–æ–≤—ã–µ —Ç–∞–ø—ã:</label>
                                    <input type="number" id="setting-base-taps" value="100" min="50" class="w-full p-2 bg-gray-700 rounded text-white">
                                </div>
                                <div>
                                    <label class="block text-sm mb-1">–ê–ª–º–∞–∑–æ–≤ –∑–∞ —Ç–∞–ø:</label>
                                    <input type="number" id="setting-diamonds-per-tap" value="0.0001" step="0.0001" class="w-full p-2 bg-gray-700 rounded text-white">
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <h3 class="text-lg font-bold mb-2">‚è∞ –í—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm mb-1">–ö—É–ª–¥–∞—É–Ω (—á–∞—Å—ã):</label>
                                    <input type="number" id="setting-cooldown-hours" value="4" min="1" max="24" class="w-full p-2 bg-gray-700 rounded text-white">
                                </div>
                            </div>
                        </div>
                        
                        <button id="save-settings-btn" class="w-full p-2 bg-green-600 rounded hover:bg-green-700">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    </div>
                    
                    <button id="settings-back-btn" class="w-full p-2 bg-blue-600 rounded hover:bg-blue-700">‚Üê –ù–∞–∑–∞–¥</button>
                </div>

                <!-- Admin Users Screen -->
                <div id="admin-users-screen" class="hidden flex-col space-y-4">
                    <h1 class="text-2xl font-bold text-center">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h1>
                    <select id="user-select" class="w-full p-2 bg-gray-800 rounded text-white text-base"></select>
                    <div id="user-details" class="flex-col space-y-2">
                        <input id="admin-username" type="text" class="w-full p-2 bg-gray-800 rounded text-white text-base" placeholder="–ù–∏–∫–Ω–µ–π–º Telegram" disabled>
                        <input id="admin-phone" type="tel" class="w-full p-2 bg-gray-800 rounded text-white text-base" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω">
                        <input id="admin-email" type="email" class="w-full p-2 bg-gray-800 rounded text-white text-base" placeholder="–ü–æ—á—Ç–∞">
                        <input id="admin-ff-id" type="text" class="w-full p-2 bg-gray-800 rounded text-white text-base" placeholder="Free Fire ID">
                        <input id="admin-password" type="text" class="w-full p-2 bg-gray-800 rounded text-white text-base" placeholder="–ü–∞—Ä–æ–ª—å">
                        <input id="admin-diamonds" type="number" step="0.0001" class="w-full p-2 bg-gray-800 rounded text-white text-base" placeholder="–ë–∞–ª–∞–Ω—Å üíé">
                        <button id="save-user-btn" class="w-full p-2 bg-blue-600 rounded hover:bg-blue-700">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    </div>
                    <button id="admin-users-back-btn" class="w-full p-2 bg-blue-600 rounded hover:bg-blue-700">–ù–∞–∑–∞–¥</button>
                </div>

                <!-- Admin Guilds Screen -->
                <div id="admin-guilds-screen" class="hidden flex-col space-y-4">
                    <h1 class="text-2xl font-bold text-center">–ì–∏–ª—å–¥–∏–∏</h1>
                    <select id="guild-select-admin" class="w-full p-2 bg-gray-800 rounded text-white text-base"></select>
                    <div id="guild-details" class="flex-col space-y-2">
                        <input id="admin-guild-name" type="text" class="w-full p-2 bg-gray-800 rounded text-white text-base" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≥–∏–ª—å–¥–∏–∏">
                        <select id="admin-guild-leader" class="w-full p-2 bg-gray-800 rounded text-white text-base"></select>
                        <div id="admin-guild-members" class="flex-col space-y-1"></div>
                        <div id="admin-guild-requests" class="flex-col space-y-2"></div>
                        <button id="delete-guild-btn" class="w-full p-2 bg-red-600 rounded hover:bg-red-700">–£–¥–∞–ª–∏—Ç—å –≥–∏–ª—å–¥–∏—é</button>
                        <button id="save-guild-btn" class="w-full p-2 bg-blue-600 rounded hover:bg-blue-700">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    </div>
                    <button id="admin-guilds-back-btn" class="w-full p-2 bg-blue-600 rounded hover:bg-blue-700">–ù–∞–∑–∞–¥</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const TelegramWebApp = window.Telegram.WebApp;
        TelegramWebApp.ready();

        // State
        let currentUserId = null;
        let users = JSON.parse(localStorage.getItem('users')) || [];
        let guilds = JSON.parse(localStorage.getItem('guilds')) || [];
        let notifications = JSON.parse(localStorage.getItem('notifications')) || [];
        let activeBoosters = JSON.parse(localStorage.getItem('activeBoosters')) || {};

        // DOM Elements
        const loadingScreen = document.getElementById('loading-screen');
        const registrationScreen = document.getElementById('registration-screen');
        const mainMenu = document.getElementById('main-menu');
        const farmScreen = document.getElementById('farm-screen');
        const profileScreen = document.getElementById('profile-screen');
        const notificationsScreen = document.getElementById('notifications-screen');
        const guildScreen = document.getElementById('guild-screen');
        const guildMembersScreen = document.getElementById('guild-members-screen');
        const guildRequestsScreen = document.getElementById('guild-requests-screen');
        const shopScreen = document.getElementById('shop-screen');
        const leaderboardScreen = document.getElementById('leaderboard-screen');
        const adminPanel = document.getElementById('admin-panel');
        const adminUsersScreen = document.getElementById('admin-users-screen');
        const adminGuildsScreen = document.getElementById('admin-guilds-screen');
        const registerBtn = document.getElementById('register-btn');
        const farmBtn = document.getElementById('farm-btn');
        const guildBtn = document.getElementById('guild-btn');
        const shopBtn = document.getElementById('shop-btn');
        const leaderboardBtn = document.getElementById('leaderboard-btn');
        const profileBtn = document.getElementById('profile-btn');
        const notificationsBtn = document.getElementById('notifications-btn');
        const notificationBadge = document.getElementById('notification-badge');
        const adminBtn = document.getElementById('admin-btn');
        const tapBtn = document.getElementById('tap-btn');
        const backBtn = document.getElementById('back-btn');
        const profileBackBtn = document.getElementById('profile-back-btn');
        const notificationsBackBtn = document.getElementById('notifications-back-btn');
        const guildBackBtn = document.getElementById('guild-back-btn');
        const membersBackBtn = document.getElementById('members-back-btn');
        const requestsBackBtn = document.getElementById('requests-back-btn');
        const adminBackBtn = document.getElementById('admin-back-btn');
        const adminUsersBtn = document.getElementById('admin-users-btn');
        const adminGuildsBtn = document.getElementById('admin-guilds-btn');
        const adminUsersBackBtn = document.getElementById('admin-users-back-btn');
        const adminGuildsBackBtn = document.getElementById('admin-guilds-back-btn');
        const deleteAccountBtn = document.getElementById('delete-account-btn');
        const diamondCount = document.getElementById('diamond-count');
        const tapCount = document.getElementById('tap-count');
        const cooldown = document.getElementById('cooldown');
        const diamondBalance = document.getElementById('diamond-balance');
        const guildStatus = document.getElementById('guild-status');
        const guildNameInput = document.getElementById('guild-name');
        const createGuildBtn = document.getElementById('create-guild-btn');
        const guildSelect = document.getElementById('guild-select');
        const joinGuildBtn = document.getElementById('join-guild-btn');
        const guildMembersBtn = document.getElementById('guild-members-btn');
        const leaveGuildBtn = document.getElementById('leave-guild-btn');
        const disbandGuildBtn = document.getElementById('disband-guild-btn');
        const guildRequestsBtn = document.getElementById('guild-requests-btn');
        const guildMembersList = document.getElementById('guild-members-list');
        const guildRequestsList = document.getElementById('guild-requests-list');
        const notificationsList = document.getElementById('notifications-list');
        const clearNotificationsBtn = document.getElementById('clear-notifications-btn');
        const userSelect = document.getElementById('user-select');
        const adminUsername = document.getElementById('admin-username');
        const adminPhone = document.getElementById('admin-phone');
        const adminEmail = document.getElementById('admin-email');
        const adminFfId = document.getElementById('admin-ff-id');
        const adminPassword = document.getElementById('admin-password');
        const adminDiamonds = document.getElementById('admin-diamonds');
        const saveUserBtn = document.getElementById('save-user-btn');
        const guildSelectAdmin = document.getElementById('guild-select-admin');
        const adminGuildName = document.getElementById('admin-guild-name');
        const adminGuildLeader = document.getElementById('admin-guild-leader');
        const adminGuildMembers = document.getElementById('admin-guild-members');
        const adminGuildRequests = document.getElementById('admin-guild-requests');
        const saveGuildBtn = document.getElementById('save-guild-btn');
        const deleteGuildBtn = document.getElementById('delete-guild-btn');
        const clearDbBtn = document.getElementById('clear-db-btn');

        // Get Telegram user data
        const telegramUser = TelegramWebApp.initDataUnsafe.user;
        let telegramUsername = telegramUser ? (telegramUser.username || telegramUser.id.toString()) : 'Unknown';

        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞–º–∫–∏
        function setupDeviceFrame() {
            const container = document.getElementById('device-container');
            const screen = document.getElementById('device-screen');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä —ç–∫—Ä–∞–Ω–∞ –∏ —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –º–æ–±–∏–ª—å–Ω—ã–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º
            const isMobile = window.innerWidth <= 768 || /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            if (isMobile) {
                container.className = 'device-frame mobile-frame';
                screen.className = 'device-screen mobile-screen';
            } else {
                container.className = 'device-frame desktop-frame';
                screen.className = 'device-screen desktop-screen';
            }
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞–º–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
        setupDeviceFrame();
        window.addEventListener('resize', setupDeviceFrame);

        // Always show loading screen on page load
        setTimeout(() => {
            // Get admin settings for user updates
            const gameSettings = JSON.parse(localStorage.getItem('gameSettings')) || {
                baseTaps: 100,
                diamondsPerTap: 0.0001,
                cooldownHours: 4
            };
            
            // Update existing users with new fields
            users.forEach(user => {
                if (!user.hasOwnProperty('vipUntil')) user.vipUntil = null;
                if (!user.hasOwnProperty('totalTaps')) user.totalTaps = 0;
                if (!user.hasOwnProperty('totalDiamonds')) user.totalDiamonds = user.diamonds || 0;
                if (!user.hasOwnProperty('maxTaps')) user.maxTaps = gameSettings.baseTaps;
                // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –ø–æ–ª—è
                delete user.energy;
                delete user.maxEnergy;
                delete user.level;
                delete user.experience;
            });
            localStorage.setItem('users', JSON.stringify(users));
            
            currentUserId = localStorage.getItem('currentUserId');
            if (currentUserId && users.find(u => u.id === currentUserId)) {
                showMainMenu();
            } else {
                loadingScreen.classList.add('hidden');
                registrationScreen.classList.remove('hidden');
            }
        }, 2000);

        // Registration
        registerBtn.addEventListener('click', () => {
            const phone = document.getElementById('phone').value;
            const email = document.getElementById('email').value;
            const ffId = document.getElementById('ff-id').value;
            const password = document.getElementById('password').value;
            if (phone && email && ffId && password) {
                // Get base taps from settings
                const gameSettings = JSON.parse(localStorage.getItem('gameSettings')) || {
                    baseTaps: 100,
                    diamondsPerTap: 0.0001,
                    cooldownHours: 4
                };
                
                const user = {
                    id: generateUUID(),
                    telegramId: telegramUser ? telegramUser.id : null,
                    username: telegramUsername,
                    phone,
                    email,
                    ffId,
                    password,
                    diamonds: 0,
                    taps: 0,
                    lastTapTime: null,
                    guildId: null,
                    vipUntil: null,
                    totalTaps: 0,
                    totalDiamonds: 0,
                    maxTaps: gameSettings.baseTaps
                };
                users.push(user);
                currentUserId = user.id;
                localStorage.setItem('users', JSON.stringify(users));
                localStorage.setItem('currentUserId', currentUserId);
                showMainMenu();
            } else {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
            }
        });

        // Navigation
        farmBtn.addEventListener('click', () => {
            mainMenu.classList.add('enter-animation');
            setTimeout(() => {
                mainMenu.classList.add('hidden');
                mainMenu.classList.remove('enter-animation');
                farmScreen.classList.remove('hidden');
                updateFarmScreen();
            }, 500);
        });

        profileBtn.addEventListener('click', () => {
            mainMenu.classList.add('enter-animation');
            setTimeout(() => {
                mainMenu.classList.add('hidden');
                mainMenu.classList.remove('enter-animation');
                profileScreen.classList.remove('hidden');
                updateProfileScreen();
            }, 500);
        });

        notificationsBtn.addEventListener('click', () => {
            mainMenu.classList.add('enter-animation');
            setTimeout(() => {
                mainMenu.classList.add('hidden');
                mainMenu.classList.remove('enter-animation');
                notificationsScreen.classList.remove('hidden');
                notificationsScreen.classList.add('notifications-slide-down');
                setTimeout(() => {
                    notificationsScreen.classList.remove('notifications-slide-down');
                }, 500);
                updateNotificationsScreen();
            }, 500);
        });

        guildBtn.addEventListener('click', () => {
            mainMenu.classList.add('enter-animation');
            setTimeout(() => {
                mainMenu.classList.add('hidden');
                mainMenu.classList.remove('enter-animation');
                guildScreen.classList.remove('hidden');
                updateGuildScreen();
            }, 500);
        });

        shopBtn.addEventListener('click', () => {
            mainMenu.classList.add('enter-animation');
            setTimeout(() => {
                mainMenu.classList.add('hidden');
                mainMenu.classList.remove('enter-animation');
                shopScreen.classList.remove('hidden');
                updateShopScreen();
            }, 500);
        });

        leaderboardBtn.addEventListener('click', () => {
            mainMenu.classList.add('enter-animation');
            setTimeout(() => {
                mainMenu.classList.add('hidden');
                mainMenu.classList.remove('enter-animation');
                leaderboardScreen.classList.remove('hidden');
                updateLeaderboard();
            }, 500);
        });



        adminBtn.addEventListener('click', () => {
            mainMenu.classList.add('enter-animation');
            setTimeout(() => {
                mainMenu.classList.add('hidden');
                mainMenu.classList.remove('enter-animation');
                adminPanel.classList.remove('hidden');
            }, 500);
        });

        adminUsersBtn.addEventListener('click', () => {
            adminPanel.classList.add('enter-animation');
            setTimeout(() => {
                adminPanel.classList.add('hidden');
                adminPanel.classList.remove('enter-animation');
                adminUsersScreen.classList.remove('hidden');
                updateAdminUsersScreen();
            }, 500);
        });

        adminGuildsBtn.addEventListener('click', () => {
            adminPanel.classList.add('enter-animation');
            setTimeout(() => {
                adminPanel.classList.add('hidden');
                adminPanel.classList.remove('enter-animation');
                adminGuildsScreen.classList.remove('hidden');
                updateAdminGuildsScreen();
            }, 500);
        });

        // New Admin Navigation
        document.getElementById('admin-broadcast-btn').addEventListener('click', () => {
            adminPanel.classList.add('hidden');
            document.getElementById('admin-broadcast-screen').classList.remove('hidden');
        });

        document.getElementById('admin-analytics-btn').addEventListener('click', () => {
            adminPanel.classList.add('hidden');
            document.getElementById('admin-analytics-screen').classList.remove('hidden');
            updateAdminAnalytics();
        });

        document.getElementById('admin-settings-btn').addEventListener('click', () => {
            adminPanel.classList.add('hidden');
            document.getElementById('admin-settings-screen').classList.remove('hidden');
            loadAdminSettings();
        });

        // Broadcast functionality
        document.getElementById('broadcast-type').addEventListener('change', (e) => {
            const levelFilter = document.getElementById('broadcast-level-filter');
            if (e.target.value === 'level') {
                levelFilter.classList.remove('hidden');
            } else {
                levelFilter.classList.add('hidden');
            }
        });

        document.getElementById('send-broadcast-btn').addEventListener('click', () => {
            sendBroadcast();
        });

        document.getElementById('preview-broadcast-btn').addEventListener('click', () => {
            previewBroadcast();
        });

        // Back buttons
        document.getElementById('broadcast-back-btn').addEventListener('click', () => {
            document.getElementById('admin-broadcast-screen').classList.add('hidden');
            adminPanel.classList.remove('hidden');
        });

        document.getElementById('analytics-back-btn').addEventListener('click', () => {
            document.getElementById('admin-analytics-screen').classList.add('hidden');
            adminPanel.classList.remove('hidden');
        });

        document.getElementById('settings-back-btn').addEventListener('click', () => {
            document.getElementById('admin-settings-screen').classList.add('hidden');
            adminPanel.classList.remove('hidden');
        });

        // Admin Settings Save
        document.getElementById('save-settings-btn').addEventListener('click', () => {
            const baseTaps = parseInt(document.getElementById('setting-base-taps').value);
            const diamondsPerTap = parseFloat(document.getElementById('setting-diamonds-per-tap').value);
            const cooldownHours = parseInt(document.getElementById('setting-cooldown-hours').value);
            
            if (baseTaps >= 50 && diamondsPerTap > 0 && cooldownHours >= 1 && cooldownHours <= 24) {
                // Save settings to localStorage
                const gameSettings = {
                    baseTaps: baseTaps,
                    diamondsPerTap: diamondsPerTap,
                    cooldownHours: cooldownHours
                };
                localStorage.setItem('gameSettings', JSON.stringify(gameSettings));
                
                // Update existing users with new base taps
                users.forEach(user => {
                    user.maxTaps = baseTaps;
                });
                localStorage.setItem('users', JSON.stringify(users));
                
                alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã! –ù–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±—É–¥—É—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.');
                
                // Update current user display if needed
                const currentUser = users.find(u => u.id === currentUserId);
                if (currentUser) {
                    updateFarmScreen();
                    updateDiamondBalance();
                }
            } else {
                alert('–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –≤–≤–µ–¥–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö!');
            }
        });

        backBtn.addEventListener('click', () => {
            farmScreen.classList.add('exit-animation');
            setTimeout(() => {
                farmScreen.classList.add('hidden');
                farmScreen.classList.remove('exit-animation');
                showMainMenu();
            }, 500);
        });

        profileBackBtn.addEventListener('click', () => {
            profileScreen.classList.add('exit-animation');
            setTimeout(() => {
                profileScreen.classList.add('hidden');
                profileScreen.classList.remove('exit-animation');
                showMainMenu();
            }, 500);
        });

        notificationsBackBtn.addEventListener('click', () => {
            notificationsScreen.classList.add('notifications-slide-up');
            setTimeout(() => {
                notificationsScreen.classList.add('hidden');
                notificationsScreen.classList.remove('notifications-slide-up');
                showMainMenu();
            }, 500);
        });

        guildBackBtn.addEventListener('click', () => {
            guildScreen.classList.add('exit-animation');
            setTimeout(() => {
                guildScreen.classList.add('hidden');
                guildScreen.classList.remove('exit-animation');
                showMainMenu();
            }, 500);
        });

        membersBackBtn.addEventListener('click', () => {
            guildMembersScreen.classList.add('exit-animation');
            setTimeout(() => {
                guildMembersScreen.classList.add('hidden');
                guildMembersScreen.classList.remove('exit-animation');
                guildScreen.classList.remove('hidden');
                updateGuildScreen();
            }, 500);
        });

        requestsBackBtn.addEventListener('click', () => {
            guildRequestsScreen.classList.add('exit-animation');
            setTimeout(() => {
                guildRequestsScreen.classList.add('hidden');
                guildRequestsScreen.classList.remove('exit-animation');
                guildScreen.classList.remove('hidden');
                updateGuildScreen();
            }, 500);
        });

        // Shop Navigation
        document.getElementById('shop-back-btn').addEventListener('click', () => {
            shopScreen.classList.add('exit-animation');
            setTimeout(() => {
                shopScreen.classList.add('hidden');
                shopScreen.classList.remove('exit-animation');
                showMainMenu();
            }, 500);
        });

        // Leaderboard Navigation
        document.getElementById('leaderboard-back-btn').addEventListener('click', () => {
            leaderboardScreen.classList.add('exit-animation');
            setTimeout(() => {
                leaderboardScreen.classList.add('hidden');
                leaderboardScreen.classList.remove('exit-animation');
                showMainMenu();
            }, 500);
        });





        adminBackBtn.addEventListener('click', () => {
            adminPanel.classList.add('exit-animation');
            setTimeout(() => {
                adminPanel.classList.add('hidden');
                adminPanel.classList.remove('exit-animation');
                showMainMenu();
            }, 500);
        });

        adminUsersBackBtn.addEventListener('click', () => {
            adminUsersScreen.classList.add('exit-animation');
            setTimeout(() => {
                adminUsersScreen.classList.add('hidden');
                adminUsersScreen.classList.remove('exit-animation');
                adminPanel.classList.remove('hidden');
            }, 500);
        });

        adminGuildsBackBtn.addEventListener('click', () => {
            adminGuildsScreen.classList.add('exit-animation');
            setTimeout(() => {
                adminGuildsScreen.classList.add('hidden');
                adminGuildsScreen.classList.remove('exit-animation');
                adminPanel.classList.remove('hidden');
            }, 500);
        });

        // Delete Account
        deleteAccountBtn.addEventListener('click', () => {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç?')) {
                const user = users.find(u => u.id === currentUserId);
                if (user.guildId) {
                    const guild = guilds.find(g => g.id === user.guildId);
                    if (guild.leaderId === currentUserId) {
                        guilds = guilds.filter(g => g.id !== user.guildId);
                        users.forEach(u => {
                            if (u.guildId === user.guildId && u.id !== currentUserId) {
                                u.guildId = null;
                                notifications.push({
                                    id: generateUUID(),
                                    userId: u.id,
                                    message: `–ì–∏–ª—å–¥–∏—è ${guild.name} —Ä–∞—Å–ø—É—â–µ–Ω–∞ –ª–∏–¥–µ—Ä–æ–º`,
                                    timestamp: new Date().toLocaleString()
                                });
                            }
                        });
                    } else {
                        guild.members = guild.members.filter(m => m !== currentUserId);
                        guild.requests = guild.requests.filter(r => r !== currentUserId);
                    }
                }
                users = users.filter(u => u.id !== currentUserId);
                notifications = notifications.filter(n => n.userId !== currentUserId);
                localStorage.setItem('users', JSON.stringify(users));
                localStorage.setItem('guilds', JSON.stringify(guilds));
                localStorage.setItem('notifications', JSON.stringify(notifications));
                localStorage.removeItem('currentUserId');
                currentUserId = null;
                loadingScreen.classList.remove('hidden');
                mainMenu.classList.add('hidden');
                profileScreen.classList.add('hidden');
                setTimeout(() => {
                    loadingScreen.classList.add('hidden');
                    registrationScreen.classList.remove('hidden');
                }, 1000);
            }
        });

        // Shop Logic
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('buy-booster-btn')) {
                const type = e.target.getAttribute('data-type');
                const price = parseFloat(e.target.getAttribute('data-price'));
                const currency = e.target.getAttribute('data-currency');
                buyBooster(type, price, currency);
            }
            if (e.target.classList.contains('buy-premium-btn')) {
                const type = e.target.getAttribute('data-type');
                const price = parseFloat(e.target.getAttribute('data-price'));
                const currency = e.target.getAttribute('data-currency');
                buyPremium(type, price, currency);
            }
        });

        // Farming Logic
        tapBtn.addEventListener('click', () => {
            const user = users.find(u => u.id === currentUserId);
            const now = Date.now();

            // Get cooldown hours from settings
            const gameSettings = JSON.parse(localStorage.getItem('gameSettings')) || {
                baseTaps: 100,
                diamondsPerTap: 0.0001,
                cooldownHours: 4
            };
            
            // Reset taps if cooldown period passed
            if (!user.lastTapTime || now - user.lastTapTime >= gameSettings.cooldownHours * 60 * 60 * 1000) {
                user.taps = 0;
                user.lastTapTime = now;
            }

            // Check if user has taps remaining
            if (user.taps < user.maxTaps) {
                user.taps++;
                user.totalTaps++;
                
                // Get settings from localStorage or use defaults
                const gameSettings = JSON.parse(localStorage.getItem('gameSettings')) || {
                    baseTaps: 100,
                    diamondsPerTap: 0.0001,
                    cooldownHours: 4
                };
                
                let diamondGain = gameSettings.diamondsPerTap;
                
                // Apply boosters
                const userBoosters = activeBoosters[currentUserId] || {};
                if (userBoosters.diamonds && userBoosters.diamonds > now) {
                    diamondGain *= 3;
                }
                if (userBoosters.mega && userBoosters.mega > now) {
                    diamondGain *= 5;
                }
                
                // VIP bonus
                if (user.vipUntil && user.vipUntil > now) {
                    diamondGain *= 2;
                }
                
                user.diamonds += diamondGain;
                user.totalDiamonds += diamondGain;
                
                localStorage.setItem('users', JSON.stringify(users));
                localStorage.setItem('notifications', JSON.stringify(notifications));
                updateFarmScreen();
                updateDiamondBalance();
                updateNotificationBadge();
            } else {
                tapBtn.disabled = true;
                cooldown.classList.remove('hidden');
                startCooldown();
            }
        });

        // Notifications Logic
        clearNotificationsBtn.addEventListener('click', () => {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è?')) {
                notifications = notifications.filter(n => n.userId !== currentUserId);
                localStorage.setItem('notifications', JSON.stringify(notifications));
                updateNotificationsScreen();
                updateNotificationBadge();
            }
        });

        // Guild Logic
        createGuildBtn.addEventListener('click', () => {
            const user = users.find(u => u.id === currentUserId);
            const guildName = guildNameInput.value.trim();
            if (!guildName) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–∏–ª—å–¥–∏–∏!');
                return;
            }
            if (user.diamonds < 10) {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∞–ª–º–∞–∑–æ–≤! –ù—É–∂–Ω–æ 10 üíé');
                return;
            }
            if (user.guildId) {
                alert('–í—ã —É–∂–µ —Å–æ—Å—Ç–æ–∏—Ç–µ –≤ –≥–∏–ª—å–¥–∏–∏!');
                return;
            }
            user.diamonds -= 10;
            user.guildId = generateUUID();
            const newGuild = {
                id: user.guildId,
                name: guildName,
                leaderId: currentUserId,
                members: [currentUserId],
                requests: []
            };
            guilds.push(newGuild);
            localStorage.setItem('users', JSON.stringify(users));
            localStorage.setItem('guilds', JSON.stringify(guilds));
            updateGuildScreen();
            updateDiamondBalance();
            alert('–ì–∏–ª—å–¥–∏—è —Å–æ–∑–¥–∞–Ω–∞!');
        });

        joinGuildBtn.addEventListener('click', () => {
            const user = users.find(u => u.id === currentUserId);
            const selectedGuildId = guildSelect.value;
            if (!selectedGuildId) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ –≥–∏–ª—å–¥–∏—é!');
                return;
            }
            if (user.guildId) {
                alert('–í—ã —É–∂–µ —Å–æ—Å—Ç–æ–∏—Ç–µ –≤ –≥–∏–ª—å–¥–∏–∏!');
                return;
            }
            const guild = guilds.find(g => g.id === selectedGuildId);
            if (!guild.requests.includes(currentUserId)) {
                guild.requests.push(currentUserId);
                notifications.push({
                    id: generateUUID(),
                    userId: guild.leaderId,
                    message: `–ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ –Ω–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ –æ—Ç ${user.username}`,
                    timestamp: new Date().toLocaleString()
                });
                localStorage.setItem('guilds', JSON.stringify(guilds));
                localStorage.setItem('notifications', JSON.stringify(notifications));
                alert('–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–∏–¥–µ—Ä—É –≥–∏–ª—å–¥–∏–∏!');
            } else {
                alert('–ó–∞—è–≤–∫–∞ —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!');
            }
            updateGuildScreen();
            updateNotificationBadge();
        });

        guildMembersBtn.addEventListener('click', () => {
            guildScreen.classList.add('hidden');
            guildMembersScreen.classList.remove('hidden');
            updateGuildMembersScreen();
        });

        leaveGuildBtn.addEventListener('click', () => {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø–æ–∫–∏–Ω—É—Ç—å –≥–∏–ª—å–¥–∏—é?')) {
                const user = users.find(u => u.id === currentUserId);
                const guild = guilds.find(g => g.id === user.guildId);
                guild.members = guild.members.filter(m => m !== currentUserId);
                guild.requests = guild.requests.filter(r => r !== currentUserId);
                user.guildId = null;
                localStorage.setItem('users', JSON.stringify(users));
                localStorage.setItem('guilds', JSON.stringify(guilds));
                updateGuildScreen();
                alert('–í—ã –ø–æ–∫–∏–Ω—É–ª–∏ –≥–∏–ª—å–¥–∏—é!');
            }
        });

        disbandGuildBtn.addEventListener('click', () => {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Ä–∞—Å–ø—É—Å—Ç–∏—Ç—å –≥–∏–ª—å–¥–∏—é?')) {
                const user = users.find(u => u.id === currentUserId);
                const guild = guilds.find(g => g.id === user.guildId);
                users.forEach(u => {
                    if (u.guildId === guild.id && u.id !== currentUserId) {
                        u.guildId = null;
                        notifications.push({
                            id: generateUUID(),
                            userId: u.id,
                            message: `–ì–∏–ª—å–¥–∏—è ${guild.name} —Ä–∞—Å–ø—É—â–µ–Ω–∞ –ª–∏–¥–µ—Ä–æ–º`,
                            timestamp: new Date().toLocaleString()
                        });
                    }
                });
                guilds = guilds.filter(g => g.id !== guild.id);
                user.guildId = null;
                localStorage.setItem('users', JSON.stringify(users));
                localStorage.setItem('guilds', JSON.stringify(guilds));
                localStorage.setItem('notifications', JSON.stringify(notifications));
                updateGuildScreen();
                updateNotificationBadge();
                alert('–ì–∏–ª—å–¥–∏—è —Ä–∞—Å–ø—É—â–µ–Ω–∞!');
            }
        });

        guildRequestsBtn.addEventListener('click', () => {
            guildScreen.classList.add('hidden');
            guildRequestsScreen.classList.remove('hidden');
            updateGuildRequestsScreen();
        });

        // Admin Users Logic
        userSelect.addEventListener('change', () => {
            const selectedUserId = userSelect.value;
            const user = users.find(u => u.id === selectedUserId);
            if (user) {
                adminUsername.value = user.username;
                adminPhone.value = user.phone;
                adminEmail.value = user.email;
                adminFfId.value = user.ffId;
                adminPassword.value = user.password;
                adminDiamonds.value = user.diamonds.toFixed(4);
            }
        });

        saveUserBtn.addEventListener('click', () => {
            const selectedUserId = userSelect.value;
            const user = users.find(u => u.id === selectedUserId);
            if (user) {
                const newPhone = adminPhone.value;
                const newEmail = adminEmail.value;
                const newFfId = adminFfId.value;
                const newPassword = adminPassword.value;
                const newDiamonds = parseFloat(adminDiamonds.value);
                if (newPhone && newEmail && newFfId && newPassword && !isNaN(newDiamonds) && newDiamonds >= 0) {
                    user.phone = newPhone;
                    user.email = newEmail;
                    user.ffId = newFfId;
                    user.password = newPassword;
                    user.diamonds = newDiamonds;
                    localStorage.setItem('users', JSON.stringify(users));
                    alert('–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω—ã!');
                    if (selectedUserId === currentUserId) {
                        updateDiamondBalance();
                        updateFarmScreen();
                        updateProfileScreen();
                    }
                } else {
                    alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!');
                }
            }
        });

        // Admin Guilds Logic
        guildSelectAdmin.addEventListener('change', () => {
            updateAdminGuildsScreen();
        });

        saveGuildBtn.addEventListener('click', () => {
            const selectedGuildId = guildSelectAdmin.value;
            const guild = guilds.find(g => g.id === selectedGuildId);
            if (guild) {
                const newName = adminGuildName.value.trim();
                const newLeaderId = adminGuildLeader.value;
                if (!newName) {
                    alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–∏–ª—å–¥–∏–∏!');
                    return;
                }
                if (!newLeaderId) {
                    alert('–í—ã–±–µ—Ä–∏—Ç–µ –ª–∏–¥–µ—Ä–∞!');
                    return;
                }
                guild.name = newName;
                if (guild.leaderId !== newLeaderId) {
                    if (!guild.members.includes(newLeaderId)) {
                        alert('–ù–æ–≤—ã–π –ª–∏–¥–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–º –≥–∏–ª—å–¥–∏–∏!');
                        return;
                    }
                    guild.leaderId = newLeaderId;
                    notifications.push({
                        id: generateUUID(),
                        userId: newLeaderId,
                        message: `–í—ã –Ω–∞–∑–Ω–∞—á–µ–Ω—ã –ª–∏–¥–µ—Ä–æ–º –≥–∏–ª—å–¥–∏–∏ ${guild.name}`,
                        timestamp: new Date().toLocaleString()
                    });
                    localStorage.setItem('notifications', JSON.stringify(notifications));
                    updateNotificationBadge();
                }
                localStorage.setItem('guilds', JSON.stringify(guilds));
                alert('–î–∞–Ω–Ω—ã–µ –≥–∏–ª—å–¥–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!');
                updateAdminGuildsScreen();
            }
        });

        deleteGuildBtn.addEventListener('click', () => {
            const selectedGuildId = guildSelectAdmin.value;
            if (!selectedGuildId) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ –≥–∏–ª—å–¥–∏—é!');
                return;
            }
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≥–∏–ª—å–¥–∏—é?')) {
                const guild = guilds.find(g => g.id === selectedGuildId);
                users.forEach(u => {
                    if (u.guildId === guild.id) {
                        u.guildId = null;
                        notifications.push({
                            id: generateUUID(),
                            userId: u.id,
                            message: `–ì–∏–ª—å–¥–∏—è ${guild.name} —É–¥–∞–ª–µ–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º`,
                            timestamp: new Date().toLocaleString()
                        });
                    }
                });
                guilds = guilds.filter(g => g.id !== selectedGuildId);
                localStorage.setItem('users', JSON.stringify(users));
                localStorage.setItem('guilds', JSON.stringify(guilds));
                localStorage.setItem('notifications', JSON.stringify(notifications));
                updateAdminGuildsScreen();
                updateNotificationBadge();
                alert('–ì–∏–ª—å–¥–∏—è —É–¥–∞–ª–µ–Ω–∞!');
            }
        });

        clearDbBtn.addEventListener('click', () => {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö? –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –≥–∏–ª—å–¥–∏–∏ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã!')) {
                users = [];
                guilds = [];
                notifications = [];
                localStorage.setItem('users', JSON.stringify(users));
                localStorage.setItem('guilds', JSON.stringify(guilds));
                localStorage.setItem('notifications', JSON.stringify(notifications));
                localStorage.removeItem('currentUserId');
                currentUserId = null;
                loadingScreen.classList.remove('hidden');
                adminPanel.classList.add('hidden');
                setTimeout(() => {
                    loadingScreen.classList.add('hidden');
                    registrationScreen.classList.remove('hidden');
                }, 1000);
            }
        });

        // Payment functions
        function buyBooster(type, price, currency) {
            showLoadingPayment();
            
            if (currency === 'ton') {
                // TON payment —á–µ—Ä–µ–∑ Telegram WebApp
                initTonPayment(type, price, 'booster');
            } else if (currency === 'stars') {
                // Telegram Stars payment
                initStarsPayment(type, price, 'booster');
            }
        }

        function buyPremium(type, price, currency) {
            showLoadingPayment();
            
            if (currency === 'ton') {
                initTonPayment(type, price, 'premium');
            }
        }

        // TON Payment —á–µ—Ä–µ–∑ Telegram
        function initTonPayment(itemType, price, category) {
            try {
                hideLoadingPayment();
                
                if (!window.Telegram?.WebApp) {
                    throw new Error('Telegram WebApp API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                }

                const webApp = window.Telegram.WebApp;
                
                if (!webApp.openInvoice) {
                    throw new Error('openInvoice –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
                }

                // –°–æ–∑–¥–∞–µ–º –∏–Ω–≤–æ–π—Å –¥–ª—è TON (—á–µ—Ä–µ–∑ Stars –∫–∞–∫ –≤–∞–ª—é—Ç—É)
                const invoice = {
                    title: category === 'booster' ? `ÔøΩ ${getBoosterName(itemType)}` : 'üëë VIP –°—Ç–∞—Ç—É—Å',
                    description: category === 'booster' ? 
                        `–ü–æ–∫—É–ø–∫–∞ –±—É—Å—Ç–µ—Ä–∞: ${getBoosterName(itemType)}` : 
                        '–ü—Ä–µ–º–∏—É–º –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ 30 –¥–Ω–µ–π —Å —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–º–∏ –±–æ–Ω—É—Å–∞–º–∏',
                    payload: `ton_${category}_${itemType}_${currentUserId}_${Date.now()}`,
                    provider_token: '', // –ü—É—Å—Ç–æ–π –¥–ª—è Stars
                    currency: 'XTR',
                    prices: [{
                        label: category === 'booster' ? getBoosterName(itemType) : 'VIP –Ω–∞ 30 –¥–Ω–µ–π',
                        amount: Math.floor(price * 100) // TON –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ Stars –¥–ª—è –¥–µ–º–æ
                    }],
                    need_name: false,
                    need_phone_number: false,
                    need_email: false,
                    need_shipping_address: false,
                    send_phone_number_to_provider: false,
                    send_email_to_provider: false,
                    is_flexible: false
                };

                console.log('Creating TON invoice:', invoice);

                // –û—Ç–∫—Ä—ã–≤–∞–µ–º –∏–Ω–≤–æ–π—Å
                webApp.openInvoice(invoice, (status) => {
                    console.log('TON Payment callback status:', status);
                    handlePaymentResult(status, itemType, category);
                });

            } catch (error) {
                console.error('TON payment error:', error);
                hideLoadingPayment();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
                showTonPaymentDialog(itemType, category, price);
            }
        }

        // Telegram Stars Payment
        function initStarsPayment(itemType, price, category) {
            try {
                hideLoadingPayment();
                
                if (!window.Telegram?.WebApp) {
                    throw new Error('Telegram WebApp API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                }

                const webApp = window.Telegram.WebApp;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É Stars
                if (!webApp.openInvoice) {
                    throw new Error('openInvoice –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
                }

                // –°–æ–∑–¥–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏–Ω–≤–æ–π—Å –¥–ª—è Telegram Stars
                const invoice = {
                    title: `‚≠ê ${getBoosterName(itemType)}`,
                    description: `–ü–æ–∫—É–ø–∫–∞ –±—É—Å—Ç–µ—Ä–∞ –∑–∞ ${price} Telegram Stars`,
                    payload: `stars_${category}_${itemType}_${currentUserId}_${Date.now()}`,
                    provider_token: '', // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—É—Å—Ç–æ–π –¥–ª—è Stars
                    currency: 'XTR',
                    prices: [{
                        label: getBoosterName(itemType),
                        amount: price
                    }],
                    need_name: false,
                    need_phone_number: false,
                    need_email: false,
                    need_shipping_address: false,
                    send_phone_number_to_provider: false,
                    send_email_to_provider: false,
                    is_flexible: false
                };

                console.log('Creating Stars invoice:', invoice);

                // –û—Ç–∫—Ä—ã–≤–∞–µ–º –∏–Ω–≤–æ–π—Å –¥–ª—è –æ–ø–ª–∞—Ç—ã –∑–≤–µ–∑–¥–∞–º–∏
                webApp.openInvoice(invoice, (status) => {
                    console.log('Payment callback status:', status);
                    handlePaymentResult(status, itemType, category);
                });

            } catch (error) {
                console.error('Stars payment error:', error);
                hideLoadingPayment();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
                showStarsPaymentDialog(itemType, category, price);
            }
        }

        // URL generators for invoices
        function createTelegramInvoice(invoiceData) {
            // –°–æ–∑–¥–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏–Ω–≤–æ–π—Å URL –¥–ª—è Telegram
            const baseParams = {
                title: invoiceData.title,
                description: invoiceData.description,
                payload: invoiceData.payload,
                currency: invoiceData.currency,
                prices: JSON.stringify(invoiceData.prices)
            };
            
            if (invoiceData.start_parameter) {
                baseParams.start_parameter = invoiceData.start_parameter;
            }
            
            const params = new URLSearchParams(baseParams);
            return `https://t.me/$YourBotName?${params.toString()}`;
        }

        // –î–∏–∞–ª–æ–≥ –¥–ª—è –æ–ø–ª–∞—Ç—ã Stars
        function showStarsPaymentDialog(itemType, category, price) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-gray-800 p-6 rounded-lg max-w-sm w-full mx-4">
                    <h3 class="text-xl font-bold mb-4 text-center">‚≠ê –û–ø–ª–∞—Ç–∞ Stars</h3>
                    <p class="text-center mb-4">${getBoosterName(itemType)}</p>
                    <p class="text-center mb-6 text-gray-300">–¶–µ–Ω–∞: ${price} ‚≠ê Telegram Stars</p>
                    
                    <div class="bg-yellow-800 p-3 rounded mb-4">
                        <p class="text-sm text-center">üîß –î–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π —Å–æ–∑–¥–∞–π—Ç–µ Telegram –±–æ—Ç–∞ –∏ —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ PAYMENT_SETUP.md</p>
                    </div>
                    
                    <div class="space-y-3">
                        <button onclick="testStarsPayment('${itemType}', '${category}', ${price})" 
                                class="w-full p-3 bg-yellow-600 rounded hover:bg-yellow-700">
                            ‚≠ê –¢–µ—Å—Ç Stars API
                        </button>
                        
                        <button onclick="simulatePaymentFromModal('${itemType}', '${category}')" 
                                class="w-full p-3 bg-green-600 rounded hover:bg-green-700">
                            ‚úÖ –î–µ–º–æ –ø–æ–∫—É–ø–∫–∞ (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)
                        </button>
                        
                        <button onclick="window.open('https://core.telegram.org/bots/payments#stars', '_blank')" 
                                class="w-full p-3 bg-blue-600 rounded hover:bg-blue-700">
                            üìñ –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Stars
                        </button>
                        
                        <button onclick="closePaymentModal()" 
                                class="w-full p-3 bg-gray-600 rounded hover:bg-gray-700">
                            ‚ùå –û—Ç–º–µ–Ω–∞
                        </button>
                    </div>
                </div>
            `;
            modal.id = 'payment-modal';
            document.body.appendChild(modal);
        }

        // –î–∏–∞–ª–æ–≥ –¥–ª—è –æ–ø–ª–∞—Ç—ã TON
        function showTonPaymentDialog(itemType, category, price) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-gray-800 p-6 rounded-lg max-w-sm w-full mx-4">
                    <h3 class="text-xl font-bold mb-4 text-center">üíé –û–ø–ª–∞—Ç–∞ TON</h3>
                    <p class="text-center mb-4">${category === 'booster' ? getBoosterName(itemType) : 'VIP –°—Ç–∞—Ç—É—Å'}</p>
                    <p class="text-center mb-6 text-gray-300">–¶–µ–Ω–∞: ${price} TON</p>
                    
                    <div class="bg-blue-800 p-3 rounded mb-4">
                        <p class="text-sm text-center">üîß –î–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ TON –ø–ª–∞—Ç–µ–∂–µ–π –Ω—É–∂–µ–Ω —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä –∏–ª–∏ TON Connect</p>
                    </div>
                    
                    <div class="space-y-3">
                        <button onclick="simulatePaymentFromModal('${itemType}', '${category}')" 
                                class="w-full p-3 bg-green-600 rounded hover:bg-green-700">
                            ‚úÖ –î–µ–º–æ –ø–æ–∫—É–ø–∫–∞ (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)
                        </button>
                        
                        <button onclick="window.open('https://docs.ton.org/develop/dapps/ton-connect', '_blank')" 
                                class="w-full p-3 bg-blue-600 rounded hover:bg-blue-700">
                            üìñ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å TON Connect
                        </button>
                        
                        <button onclick="closePaymentModal()" 
                                class="w-full p-3 bg-gray-600 rounded hover:bg-gray-700">
                            ‚ùå –û—Ç–º–µ–Ω–∞
                        </button>
                    </div>
                </div>
            `;
            modal.id = 'payment-modal';
            document.body.appendChild(modal);
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –æ–ø–ª–∞—Ç—ã
        window.simulatePaymentFromModal = function(itemType, category) {
            closePaymentModal();
            if (category === 'booster') {
                applyBooster(itemType);
            } else if (category === 'premium') {
                applyPremium(itemType);
            }
            showSuccessMessage('–î–µ–º–æ –ø–æ–∫—É–ø–∫–∞ —É—Å–ø–µ—à–Ω–∞! –¢–æ–≤–∞—Ä –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω.');
        };

        window.testStarsPayment = function(itemType, category, price) {
            closePaymentModal();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            showLoadingPayment();
            
            // –ò–º–∏—Ç–∏—Ä—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–π API –≤—ã–∑–æ–≤
            setTimeout(() => {
                hideLoadingPayment();
                
                if (window.Telegram?.WebApp?.openInvoice) {
                    showErrorMessage('‚ö†Ô∏è –î–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π –Ω—É–∂–µ–Ω –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –±–æ—Ç —Å –ø–ª–∞—Ç–µ–∂–Ω—ã–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º');
                } else {
                    showErrorMessage('‚ùå Telegram WebApp API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (–æ—Ç–∫—Ä–æ–π—Ç–µ –≤ Telegram)');
                }
                
                // –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º –¥–µ–º–æ
                setTimeout(() => {
                    if (confirm('–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä –≤ –¥–µ–º–æ —Ä–µ–∂–∏–º–µ?')) {
                        if (category === 'booster') {
                            applyBooster(itemType);
                        } else if (category === 'premium') {
                            applyPremium(itemType);
                        }
                        showSuccessMessage('üéÆ –î–µ–º–æ –∞–∫—Ç–∏–≤–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!');
                    }
                }, 2000);
            }, 1500);
        };

        window.closePaymentModal = function() {
            const modal = document.getElementById('payment-modal');
            if (modal) {
                modal.remove();
            }
        };

        // Helper functions for payments
        function getBoosterName(type) {
            const names = {
                speed: '–£—Å–∫–æ—Ä–µ–Ω–∏–µ —Ç–∞–ø–æ–≤ x2',
                diamonds: '–£—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∞–ª–º–∞–∑—ã x3',
                taps: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–∞–ø—ã +50',
                mega: '–ú–µ–≥–∞ –±—É—Å—Ç x5'
            };
            return names[type] || type;
        }

        // Loading and UI functions
        function showLoadingPayment() {
            const loading = document.createElement('div');
            loading.id = 'payment-loading';
            loading.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            loading.innerHTML = `
                <div class="bg-gray-800 p-6 rounded-lg text-center">
                    <div class="animate-spin rounded-full h-12 w-12 border-t-4 border-blue-500 mx-auto mb-4"></div>
                    <p class="text-white">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–ª–∞—Ç–µ–∂–∞...</p>
                </div>
            `;
            document.body.appendChild(loading);
        }

        function hideLoadingPayment() {
            const loading = document.getElementById('payment-loading');
            if (loading) {
                loading.remove();
            }
        }

        function handlePaymentResult(status, itemType, category) {
            switch(status) {
                case 'paid':
                    if (category === 'booster') {
                        applyBooster(itemType);
                    } else if (category === 'premium') {
                        applyPremium(itemType);
                    }
                    showSuccessMessage('–ü–ª–∞—Ç–µ–∂ —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω!');
                    break;
                case 'cancelled':
                    showErrorMessage('–ü–ª–∞—Ç–µ–∂ –æ—Ç–º–µ–Ω–µ–Ω');
                    break;
                case 'failed':
                    showErrorMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞');
                    break;
                default:
                    showErrorMessage('–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞');
            }
        }

        // –°–∏–º—É–ª—è—Ü–∏—è –ø–ª–∞—Ç–µ–∂–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function simulatePayment(itemType, category) {
            if (confirm(`–°–∏–º—É–ª—è—Ü–∏—è –ø–ª–∞—Ç–µ–∂–∞. –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å ${getBoosterName(itemType)}?`)) {
                if (category === 'booster') {
                    applyBooster(itemType);
                } else if (category === 'premium') {
                    applyPremium(itemType);
                }
                showSuccessMessage('–ü–ª–∞—Ç–µ–∂ —Å–∏–º—É–ª–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ!');
            }
        }

        function showSuccessMessage(message) {
            // –°–æ–∑–¥–∞–µ–º –∫—Ä–∞—Å–∏–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg z-50';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function showErrorMessage(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 bg-red-600 text-white px-6 py-3 rounded-lg shadow-lg z-50';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function applyBooster(type) {
            const user = users.find(u => u.id === currentUserId);
            const now = Date.now();
            
            if (!activeBoosters[currentUserId]) {
                activeBoosters[currentUserId] = {};
            }
            
            switch (type) {
                case 'speed':
                    activeBoosters[currentUserId].speed = now + (30 * 60 * 1000); // 30 minutes
                    break;
                case 'diamonds':
                    activeBoosters[currentUserId].diamonds = now + (60 * 60 * 1000); // 1 hour
                    break;
                case 'taps':
                    user.taps = Math.max(0, user.taps - 50); // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º 50 —Ç–∞–ø–æ–≤
                    break;
                case 'mega':
                    activeBoosters[currentUserId].mega = now + (2 * 60 * 60 * 1000); // 2 hours
                    break;
            }
            
            localStorage.setItem('users', JSON.stringify(users));
            localStorage.setItem('activeBoosters', JSON.stringify(activeBoosters));
            updateFarmScreen();
        }

        function applyPremium(type) {
            const user = users.find(u => u.id === currentUserId);
            const now = Date.now();
            
            if (type === 'vip') {
                user.vipUntil = now + (30 * 24 * 60 * 60 * 1000); // 30 days
                user.maxTaps += 100; // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ —Ç–∞–ø—ã
            }
            
            localStorage.setItem('users', JSON.stringify(users));
            updateProfileScreen();
            updateFarmScreen();
        }

        function generateInvoiceId() {
            return `inv_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
        }

        // Admin Functions
        function sendBroadcast() {
            const type = document.getElementById('broadcast-type').value;
            const title = document.getElementById('broadcast-title').value.trim();
            const message = document.getElementById('broadcast-message').value.trim();
            const minLevel = parseInt(document.getElementById('broadcast-min-level').value) || 1;
            
            if (!title || !message) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ!');
                return;
            }
            
            let targetUsers = [];
            const now = Date.now();
            
            switch (type) {
                case 'all':
                    targetUsers = users;
                    break;
                case 'vip':
                    targetUsers = users.filter(u => u.vipUntil && u.vipUntil > now);
                    break;
                case 'level':
                    targetUsers = users.filter(u => u.level >= minLevel);
                    break;
                case 'guild':
                    targetUsers = users.filter(u => u.guildId);
                    break;
            }
            
            const notification = {
                id: generateUUID(),
                message: `üì¢ ${title}: ${message}`,
                timestamp: new Date().toLocaleString(),
                read: false
            };
            
            targetUsers.forEach(user => {
                notifications.push({
                    ...notification,
                    id: generateUUID(),
                    userId: user.id
                });
            });
            
            localStorage.setItem('notifications', JSON.stringify(notifications));
            updateNotificationBadge();
            
            // Clear form
            document.getElementById('broadcast-title').value = '';
            document.getElementById('broadcast-message').value = '';
            
            showSuccessMessage(`–†–∞—Å—Å—ã–ª–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ ${targetUsers.length} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º!`);
        }

        function previewBroadcast() {
            const type = document.getElementById('broadcast-type').value;
            const title = document.getElementById('broadcast-title').value.trim();
            const message = document.getElementById('broadcast-message').value.trim();
            const minLevel = parseInt(document.getElementById('broadcast-min-level').value) || 1;
            
            let targetCount = 0;
            const now = Date.now();
            
            switch (type) {
                case 'all':
                    targetCount = users.length;
                    break;
                case 'vip':
                    targetCount = users.filter(u => u.vipUntil && u.vipUntil > now).length;
                    break;
                case 'level':
                    targetCount = users.filter(u => u.level >= minLevel).length;
                    break;
                case 'guild':
                    targetCount = users.filter(u => u.guildId).length;
                    break;
            }
            
            alert(`–ü—Ä–µ–≤—å—é —Ä–∞—Å—Å—ã–ª–∫–∏:\n\n–ó–∞–≥–æ–ª–æ–≤–æ–∫: ${title}\n–°–æ–æ–±—â–µ–Ω–∏–µ: ${message}\n\n–ü–æ–ª—É—á–∞—Ç–µ–ª–µ–π: ${targetCount}`);
        }

        function updateAdminAnalytics() {
            const now = Date.now();
            
            // Diamonds analytics
            const totalDiamonds = users.reduce((sum, u) => sum + u.totalDiamonds, 0);
            const avgDiamonds = users.length > 0 ? totalDiamonds / users.length : 0;
            const maxDiamonds = Math.max(...users.map(u => u.totalDiamonds));
            
            document.getElementById('total-diamonds').textContent = totalDiamonds.toFixed(4);
            document.getElementById('avg-diamonds').textContent = avgDiamonds.toFixed(4);
            document.getElementById('max-diamonds').textContent = maxDiamonds.toFixed(4);
            
            // Activity analytics
            const totalTaps = users.reduce((sum, u) => sum + u.totalTaps, 0);
            const avgTaps = users.length > 0 ? Math.round(totalTaps / users.length) : 0;
            const activeToday = users.filter(u => u.lastTapTime && now - u.lastTapTime < 24 * 60 * 60 * 1000).length;
            
            document.getElementById('total-taps').textContent = totalTaps.toLocaleString();
            document.getElementById('avg-taps').textContent = avgTaps.toLocaleString();
            document.getElementById('active-today').textContent = activeToday;
            
            // User distribution by diamond ranges
            const diamondRanges = {
                '0-1': 0,
                '1-10': 0,
                '10-50': 0,
                '50+': 0
            };
            
            users.forEach(u => {
                if (u.diamonds < 1) diamondRanges['0-1']++;
                else if (u.diamonds < 10) diamondRanges['1-10']++;
                else if (u.diamonds < 50) diamondRanges['10-50']++;
                else diamondRanges['50+']++;
            });
            
            const levelDiv = document.getElementById('level-distribution');
            levelDiv.innerHTML = '';
            Object.keys(diamondRanges).forEach(range => {
                const div = document.createElement('div');
                div.textContent = `${range} üíé: ${diamondRanges[range]} –∏–≥—Ä–æ–∫–æ–≤`;
                levelDiv.appendChild(div);
            });
        }

        function updateAdminStats() {
            const now = Date.now();
            const vipCount = users.filter(u => u.vipUntil && u.vipUntil > now).length;
            const onlineCount = users.filter(u => u.lastTapTime && now - u.lastTapTime < 30 * 60 * 1000).length;
            
            document.getElementById('admin-users-count').textContent = users.length;
            document.getElementById('admin-guilds-count').textContent = guilds.length;
            document.getElementById('admin-online-count').textContent = onlineCount;
            document.getElementById('admin-vip-count').textContent = vipCount;
        }

        function showMainMenu() {
            loadingScreen.classList.add('hidden');
            registrationScreen.classList.add('hidden');
            farmScreen.classList.add('hidden');
            profileScreen.classList.add('hidden');
            notificationsScreen.classList.add('hidden');
            guildScreen.classList.add('hidden');
            guildMembersScreen.classList.add('hidden');
            guildRequestsScreen.classList.add('hidden');
            shopScreen.classList.add('hidden');
            leaderboardScreen.classList.add('hidden');
            adminPanel.classList.add('hidden');
            // Hide new admin screens
            document.getElementById('admin-broadcast-screen').classList.add('hidden');
            document.getElementById('admin-analytics-screen').classList.add('hidden');
            document.getElementById('admin-settings-screen').classList.add('hidden');
            adminUsersScreen.classList.add('hidden');
            adminGuildsScreen.classList.add('hidden');
            mainMenu.classList.remove('hidden');
            const user = users.find(u => u.id === currentUserId);
            if (user && (user.ffId === '161686768' || user.phone === '+380689640782')) {
                adminBtn.classList.remove('hidden');
                updateAdminStats();
            } else {
                adminBtn.classList.add('hidden');
            }
            updateDiamondBalance();
            updateNotificationBadge();
        }

        function updateFarmScreen() {
            const user = users.find(u => u.id === currentUserId);
            diamondCount.textContent = `${user.diamonds.toFixed(4)} üíé`;
            tapCount.textContent = `–¢–∞–ø—ã: ${user.taps}/${user.maxTaps}`;
            
            // Check active boosters
            const now = Date.now();
            const userBoosters = activeBoosters[currentUserId] || {};
            let boosterText = '';
            
            if (userBoosters.diamonds && userBoosters.diamonds > now) {
                boosterText += ' üíéx3';
                tapBtn.classList.add('pulse-animation');
            }
            if (userBoosters.mega && userBoosters.mega > now) {
                boosterText += ' üî•x5';
                tapBtn.classList.add('pulse-animation');
            }
            if (user.vipUntil && user.vipUntil > now) {
                boosterText += ' üëëVIP';
            }
            
            if (boosterText) {
                tapCount.textContent += boosterText;
            } else {
                tapBtn.classList.remove('pulse-animation');
            }
            
            if (user.taps >= user.maxTaps) {
                tapBtn.disabled = true;
                cooldown.classList.remove('hidden');
                startCooldown();
            } else {
                tapBtn.disabled = false;
                cooldown.classList.add('hidden');
            }
        }

        function updateProfileScreen() {
            const user = users.find(u => u.id === currentUserId);
            const now = Date.now();
            const isVip = user.vipUntil && user.vipUntil > now;
            
            // Player Stats
            document.getElementById('profile-username').textContent = `${user.username}${isVip ? ' üëë' : ''}`;
            document.getElementById('profile-energy').textContent = `–ú–∞–∫—Å. —Ç–∞–ø–æ–≤: ${user.maxTaps} (${user.taps} –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ)`;
            document.getElementById('profile-diamonds').textContent = `–ë–∞–ª–∞–Ω—Å: ${user.diamonds.toFixed(4)} üíé`;
            document.getElementById('profile-total-stats').textContent = `–í—Å–µ–≥–æ —Ç–∞–ø–æ–≤: ${user.totalTaps} | –í—Å–µ–≥–æ –∞–ª–º–∞–∑–æ–≤: ${user.totalDiamonds.toFixed(4)}`;
            
            // VIP Status
            if (isVip) {
                const vipEnd = new Date(user.vipUntil).toLocaleDateString();
                document.getElementById('profile-vip-status').textContent = `üëë VIP –¥–æ: ${vipEnd}`;
                document.getElementById('profile-vip-status').className = 'text-sm text-yellow-400';
                document.getElementById('profile-username').classList.add('vip-user');
            } else {
                document.getElementById('profile-vip-status').textContent = '–û–±—ã—á–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç';
                document.getElementById('profile-vip-status').className = 'text-sm text-gray-400';
            }
            
            // Account Info
            document.getElementById('profile-phone').textContent = `–¢–µ–ª–µ—Ñ–æ–Ω: ${user.phone}`;
            document.getElementById('profile-email').textContent = `–ü–æ—á—Ç–∞: ${user.email}`;
            document.getElementById('profile-ff-id').textContent = `Free Fire ID: ${user.ffId}`;
            document.getElementById('profile-password').textContent = `–ü–∞—Ä–æ–ª—å: ${user.password}`;
            
            // Active Boosters
            const userBoosters = activeBoosters[currentUserId] || {};
            const activeBoostersDiv = document.getElementById('active-boosters-list');
            const profileBoostersDiv = document.getElementById('profile-boosters');
            
            activeBoostersDiv.innerHTML = '';
            let hasActiveBoosters = false;
            
            Object.keys(userBoosters).forEach(boosterType => {
                if (userBoosters[boosterType] > now) {
                    hasActiveBoosters = true;
                    const timeLeft = userBoosters[boosterType] - now;
                    const minutes = Math.floor(timeLeft / (1000 * 60));
                    const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
                    
                    const boosterNames = {
                        speed: 'üöÄ –£—Å–∫–æ—Ä–µ–Ω–∏–µ —Ç–∞–ø–æ–≤ x2',
                        diamonds: 'üíé –£—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∞–ª–º–∞–∑—ã x3',
                        mega: 'üî• –ú–µ–≥–∞ –±—É—Å—Ç x5'
                    };
                    
                    const p = document.createElement('p');
                    p.className = 'text-sm';
                    p.textContent = `${boosterNames[boosterType] || boosterType}: ${minutes}–º ${seconds}—Å`;
                    activeBoostersDiv.appendChild(p);
                }
            });
            
            if (hasActiveBoosters) {
                profileBoostersDiv.classList.remove('hidden');
            } else {
                profileBoostersDiv.classList.add('hidden');
            }
        }

        function updateNotificationsScreen() {
            notificationsList.innerHTML = '';
            const userNotifications = notifications.filter(n => n.userId === currentUserId);
            if (userNotifications.length === 0) {
                notificationsList.innerHTML = '<p class="text-lg text-center">–ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</p>';
            } else {
                userNotifications.forEach(notification => {
                    const div = document.createElement('div');
                    div.className = `p-3 rounded mb-2 ${notification.read ? 'bg-gray-700' : 'bg-blue-800'}`;
                    div.innerHTML = `
                        <p class="text-sm">${notification.message}</p>
                        <p class="text-xs text-gray-400 mt-1">${notification.timestamp}</p>
                    `;
                    div.addEventListener('click', () => {
                        if (!notification.read) {
                            notification.read = true;
                            localStorage.setItem('notifications', JSON.stringify(notifications));
                            updateNotificationBadge();
                            div.className = 'p-3 rounded mb-2 bg-gray-700';
                        }
                    });
                    notificationsList.appendChild(div);
                });
            }
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–º–µ—á–∞–µ–º –≤—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                let updated = false;
                userNotifications.forEach(notification => {
                    if (!notification.read) {
                        notification.read = true;
                        updated = true;
                    }
                });
                if (updated) {
                    localStorage.setItem('notifications', JSON.stringify(notifications));
                    updateNotificationBadge();
                }
            }, 3000);
        }

        function updateNotificationBadge() {
            const unreadNotifications = notifications.filter(n => n.userId === currentUserId && !n.read);
            if (unreadNotifications.length > 0) {
                notificationBadge.textContent = unreadNotifications.length;
                notificationBadge.classList.remove('hidden');
            } else {
                notificationBadge.classList.add('hidden');
            }
        }

        function updateGuildScreen() {
            const user = users.find(u => u.id === currentUserId);
            createGuildBtn.classList.add('hidden');
            guildNameInput.classList.add('hidden');
            joinGuildBtn.classList.add('hidden');
            guildSelect.classList.add('hidden');
            leaveGuildBtn.classList.add('hidden');
            disbandGuildBtn.classList.add('hidden');
            guildRequestsBtn.classList.add('hidden');
            guildMembersBtn.classList.add('hidden');

            if (user.guildId) {
                const guild = guilds.find(g => g.id === user.guildId);
                guildStatus.textContent = `–í—ã —Å–æ—Å—Ç–æ–∏—Ç–µ –≤ –≥–∏–ª—å–¥–∏–∏: ${guild.name}`;
                guildMembersBtn.classList.remove('hidden');
                if (guild.leaderId === currentUserId) {
                    disbandGuildBtn.classList.remove('hidden');
                    guildRequestsBtn.classList.remove('hidden');
                } else {
                    leaveGuildBtn.classList.remove('hidden');
                }
            } else {
                guildStatus.textContent = '–í—ã –Ω–µ —Å–æ—Å—Ç–æ–∏—Ç–µ –≤ –≥–∏–ª—å–¥–∏–∏';
                createGuildBtn.classList.remove('hidden');
                guildNameInput.classList.remove('hidden');
                joinGuildBtn.classList.remove('hidden');
                guildSelect.classList.remove('hidden');
            }

            guildSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥–∏–ª—å–¥–∏—é</option>';
            guilds.forEach(guild => {
                const option = document.createElement('option');
                option.value = guild.id;
                option.textContent = guild.name;
                guildSelect.appendChild(option);
            });
        }

        function updateGuildMembersScreen() {
            const user = users.find(u => u.id === currentUserId);
            const guild = guilds.find(g => g.id === user.guildId);
            guildMembersList.innerHTML = '';
            guild.members.forEach(memberId => {
                const member = users.find(u => u.id === memberId);
                const p = document.createElement('p');
                p.textContent = `${member.username}${memberId === guild.leaderId ? ' (–õ–∏–¥–µ—Ä)' : ''}`;
                guildMembersList.appendChild(p);
            });
        }

        function updateGuildRequestsScreen() {
            const user = users.find(u => u.id === currentUserId);
            const guild = guilds.find(g => g.id === user.guildId);
            guildRequestsList.innerHTML = '';
            guild.requests.forEach(requestId => {
                const requester = users.find(u => u.id === requestId);
                const div = document.createElement('div');
                div.className = 'flex justify-between items-center';
                div.innerHTML = `
                    <p>${requester.username}</p>
                    <div>
                        <button class="accept-request-btn p-1 bg-green-600 rounded hover:bg-green-700 text-sm" data-user-id="${requestId}">–ü—Ä–∏–Ω—è—Ç—å</button>
                        <button class="reject-request-btn p-1 bg-red-600 rounded hover:bg-red-700 text-sm" data-user-id="${requestId}">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
                    </div>
                `;
                guildRequestsList.appendChild(div);
            });

            document.querySelectorAll('.accept-request-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const userId = btn.getAttribute('data-user-id');
                    const guild = guilds.find(g => g.id === user.guildId);
                    guild.requests = guild.requests.filter(r => r !== userId);
                    guild.members.push(userId);
                    const requester = users.find(u => u.id === userId);
                    requester.guildId = guild.id;
                    notifications.push({
                        id: generateUUID(),
                        userId: userId,
                        message: `–í–∞—à–∞ –∑–∞—è–≤–∫–∞ –≤ –≥–∏–ª—å–¥–∏—é ${guild.name} –ø—Ä–∏–Ω—è—Ç–∞`,
                        timestamp: new Date().toLocaleString()
                    });
                    localStorage.setItem('users', JSON.stringify(users));
                    localStorage.setItem('guilds', JSON.stringify(guilds));
                    localStorage.setItem('notifications', JSON.stringify(notifications));
                    updateGuildRequestsScreen();
                    updateNotificationBadge();
                    alert('–ó–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞!');
                });
            });

            document.querySelectorAll('.reject-request-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const userId = btn.getAttribute('data-user-id');
                    const guild = guilds.find(g => g.id === user.guildId);
                    guild.requests = guild.requests.filter(r => r !== userId);
                    notifications.push({
                        id: generateUUID(),
                        userId: userId,
                        message: `–í–∞—à–∞ –∑–∞—è–≤–∫–∞ –≤ –≥–∏–ª—å–¥–∏—é ${guild.name} –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞`,
                        timestamp: new Date().toLocaleString()
                    });
                    localStorage.setItem('guilds', JSON.stringify(guilds));
                    localStorage.setItem('notifications', JSON.stringify(notifications));
                    updateGuildRequestsScreen();
                    updateNotificationBadge();
                    alert('–ó–∞—è–≤–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞!');
                });
            });
        }

        function updateAdminUsersScreen() {
            userSelect.innerHTML = '';
            users.forEach(user => {
                const option = document.createElement('option');
                option.value = user.id;
                option.textContent = `${user.username}`;
                userSelect.appendChild(option);
            });
            const selectedUser = users.find(u => u.id === userSelect.value);
            if (selectedUser) {
                adminUsername.value = selectedUser.username;
                adminPhone.value = selectedUser.phone;
                adminEmail.value = selectedUser.email;
                adminFfId.value = selectedUser.ffId;
                adminPassword.value = selectedUser.password;
                adminDiamonds.value = selectedUser.diamonds.toFixed(4);
            }
        }

        function updateAdminGuildsScreen() {
            guildSelectAdmin.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥–∏–ª—å–¥–∏—é</option>';
            guilds.forEach(guild => {
                const leader = users.find(u => u.id === guild.leaderId);
                const option = document.createElement('option');
                option.value = guild.id;
                option.textContent = `${guild.name} (–õ–∏–¥–µ—Ä: ${leader ? leader.username : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'})`;
                guildSelectAdmin.appendChild(option);
            });

            const selectedGuild = guilds.find(g => g.id === guildSelectAdmin.value);
            if (selectedGuild) {
                adminGuildName.value = selectedGuild.name;
                adminGuildLeader.innerHTML = '';
                selectedGuild.members.forEach(memberId => {
                    const member = users.find(u => u.id === memberId);
                    const option = document.createElement('option');
                    option.value = member.id;
                    option.textContent = `${member.username}`;
                    if (member.id === selectedGuild.leaderId) {
                        option.selected = true;
                    }
                    adminGuildLeader.appendChild(option);
                });

                adminGuildMembers.innerHTML = '';
                selectedGuild.members.forEach(memberId => {
                    const member = users.find(u => u.id === memberId);
                    const p = document.createElement('p');
                    p.textContent = `${member.username}${memberId === selectedGuild.leaderId ? ' (–õ–∏–¥–µ—Ä)' : ''}`;
                    adminGuildMembers.appendChild(p);
                });

                adminGuildRequests.innerHTML = '';
                selectedGuild.requests.forEach(requestId => {
                    const requester = users.find(u => u.id === requestId);
                    const div = document.createElement('div');
                    div.className = 'flex justify-between items-center';
                    div.innerHTML = `
                        <p>${requester.username}</p>
                        <div>
                            <button class="admin-accept-request-btn p-1 bg-green-600 rounded hover:bg-green-700 text-sm" data-user-id="${requestId}">–ü—Ä–∏–Ω—è—Ç—å</button>
                            <button class="admin-reject-request-btn p-1 bg-red-600 rounded hover:bg-red-700 text-sm" data-user-id="${requestId}">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
                        </div>
                    `;
                    adminGuildRequests.appendChild(div);
                });

                document.querySelectorAll('.admin-accept-request-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const userId = btn.getAttribute('data-user-id');
                        const guild = guilds.find(g => g.id === selectedGuild.id);
                        guild.requests = guild.requests.filter(r => r !== userId);
                        guild.members.push(userId);
                        const requester = users.find(u => u.id === userId);
                        requester.guildId = guild.id;
                        notifications.push({
                            id: generateUUID(),
                            userId: userId,
                            message: `–í–∞—à–∞ –∑–∞—è–≤–∫–∞ –≤ –≥–∏–ª—å–¥–∏—é ${guild.name} –ø—Ä–∏–Ω—è—Ç–∞`,
                            timestamp: new Date().toLocaleString()
                        });
                        localStorage.setItem('users', JSON.stringify(users));
                        localStorage.setItem('guilds', JSON.stringify(guilds));
                        localStorage.setItem('notifications', JSON.stringify(notifications));
                        updateAdminGuildsScreen();
                        updateNotificationBadge();
                        alert('–ó–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞!');
                    });
                });

                document.querySelectorAll('.admin-reject-request-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const userId = btn.getAttribute('data-user-id');
                        const guild = guilds.find(g => g.id === selectedGuild.id);
                        guild.requests = guild.requests.filter(r => r !== userId);
                        notifications.push({
                            id: generateUUID(),
                            userId: userId,
                            message: `–í–∞—à–∞ –∑–∞—è–≤–∫–∞ –≤ –≥–∏–ª—å–¥–∏—é ${guild.name} –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞`,
                            timestamp: new Date().toLocaleString()
                        });
                        localStorage.setItem('guilds', JSON.stringify(guilds));
                        localStorage.setItem('notifications', JSON.stringify(notifications));
                        updateAdminGuildsScreen();
                        updateNotificationBadge();
                        alert('–ó–∞—è–≤–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞!');
                    });
                });
            } else {
                adminGuildName.value = '';
                adminGuildLeader.innerHTML = '';
                adminGuildMembers.innerHTML = '';
                adminGuildRequests.innerHTML = '';
            }
        }

        function updateShopScreen() {
            const user = users.find(u => u.id === currentUserId);
            document.getElementById('shop-diamond-balance').textContent = `${user.diamonds.toFixed(4)} üíé`;
        }





        function updateDiamondBalance() {
            const user = users.find(u => u.id === currentUserId);
            const now = Date.now();
            const isVip = user.vipUntil && user.vipUntil > now;
            
            diamondBalance.textContent = `${user.diamonds.toFixed(4)} üíé${isVip ? ' üëë' : ''}`;
        }

        function startCooldown() {
            const user = users.find(u => u.id === currentUserId);
            
            // Get cooldown hours from settings
            const gameSettings = JSON.parse(localStorage.getItem('gameSettings')) || {
                baseTaps: 100,
                diamondsPerTap: 0.0001,
                cooldownHours: 4
            };
            
            const endTime = user.lastTapTime + gameSettings.cooldownHours * 60 * 60 * 1000;
            const interval = setInterval(() => {
                const now = Date.now();
                const timeLeft = endTime - now;
                if (timeLeft <= 0) {
                    user.taps = 0;
                    localStorage.setItem('users', JSON.stringify(users));
                    updateFarmScreen();
                    clearInterval(interval);
                } else {
                    const hours = Math.floor(timeLeft / (1000 * 60 * 60));
                    const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
                    cooldown.textContent = `–û—Å—Ç–∞–ª–æ—Å—å: ${hours}—á ${minutes}–º ${seconds}—Å`;
                }
            }, 1000);
        }

        function loadAdminSettings() {
            const gameSettings = JSON.parse(localStorage.getItem('gameSettings')) || {
                baseTaps: 100,
                diamondsPerTap: 0.0001,
                cooldownHours: 4
            };
            
            document.getElementById('setting-base-taps').value = gameSettings.baseTaps;
            document.getElementById('setting-diamonds-per-tap').value = gameSettings.diamondsPerTap;
            document.getElementById('setting-cooldown-hours').value = gameSettings.cooldownHours;
        }

        // Generate random leaderboard players
        function generateRandomPlayers() {
            const firstNames = ['–ê–ª–µ–∫—Å–∞–Ω–¥—Ä', '–î–º–∏—Ç—Ä–∏–π', '–ú–∞–∫—Å–∏–º', '–°–µ—Ä–≥–µ–π', '–ê–Ω–¥—Ä–µ–π', '–ê–ª–µ–∫—Å–µ–π', '–ê—Ä—Ç—ë–º', '–ò–ª—å—è', '–ö–∏—Ä–∏–ª–ª', '–ú–∏—Ö–∞–∏–ª', '–ù–∏–∫–∏—Ç–∞', '–ú–∞—Ç–≤–µ–π', '–†–æ–º–∞–Ω', '–ï–≥–æ—Ä', '–ê—Ä—Å–µ–Ω–∏–π', '–ò–≤–∞–Ω', '–î–µ–Ω–∏—Å', '–ï–≤–≥–µ–Ω–∏–π', '–î–∞–Ω–∏–∏–ª', '–¢–∏–º–æ—Ñ–µ–π'];
            const lastNames = ['–°–º–∏—Ä–Ω–æ–≤', '–ò–≤–∞–Ω–æ–≤', '–ö—É–∑–Ω–µ—Ü–æ–≤', '–ü–æ–ø–æ–≤', '–°–æ–∫–æ–ª–æ–≤', '–õ–µ–±–µ–¥–µ–≤', '–ö–æ–∑–ª–æ–≤', '–ù–æ–≤–∏–∫–æ–≤', '–ú–æ—Ä–æ–∑–æ–≤', '–ü–µ—Ç—Ä–æ–≤', '–í–æ–ª–∫–æ–≤', '–°–æ–ª–æ–≤—å—ë–≤', '–í–∞—Å–∏–ª—å–µ–≤', '–ó–∞–π—Ü–µ–≤', '–ü–∞–≤–ª–æ–≤', '–°–µ–º—ë–Ω–æ–≤', '–ì–æ–ª—É–±–µ–≤', '–í–∏–Ω–æ–≥—Ä–∞–¥–æ–≤', '–ë–æ–≥–¥–∞–Ω–æ–≤', '–í–æ—Ä–æ–±—å—ë–≤'];
            
            const players = [];
            
            for (let i = 0; i < 20; i++) {
                const firstName = firstNames[Math.floor(Math.random() * firstNames.length)];
                const lastName = lastNames[Math.floor(Math.random() * lastNames.length)];
                const diamonds = Math.random() * 120 + 0.0001; // –û—Ç 0.0001 –¥–æ 120 –∞–ª–º–∞–∑–æ–≤
                
                players.push({
                    username: `${firstName} ${lastName}`,
                    diamonds: diamonds
                });
            }
            
            return players.sort((a, b) => b.diamonds - a.diamonds);
        }

        // Update leaderboard
        function updateLeaderboard() {
            let randomPlayers = JSON.parse(localStorage.getItem('randomPlayers'));
            const lastUpdate = localStorage.getItem('lastLeaderboardUpdate');
            const now = Date.now();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–π—Ç–∏–Ω–≥ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç (300000 –º—Å)
            if (!randomPlayers || !lastUpdate || now - parseInt(lastUpdate) > 300000) {
                randomPlayers = generateRandomPlayers();
                localStorage.setItem('randomPlayers', JSON.stringify(randomPlayers));
                localStorage.setItem('lastLeaderboardUpdate', now.toString());
            }
            
            const currentUser = users.find(u => u.id === currentUserId);
            const leaderboardList = document.getElementById('leaderboard-list');
            leaderboardList.innerHTML = '';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ø 20
            randomPlayers.forEach((player, index) => {
                const div = document.createElement('div');
                div.className = 'flex justify-between items-center p-2 bg-gray-700 rounded mb-1';
                
                const rank = index + 1;
                const medal = rank === 1 ? 'ü•á' : rank === 2 ? 'ü•à' : rank === 3 ? 'ü•â' : `${rank}.`;
                
                div.innerHTML = `
                    <div class="flex items-center space-x-2">
                        <span class="text-lg">${medal}</span>
                        <span>${player.username}</span>
                    </div>
                    <div class="text-right">
                        <div class="text-sm">${player.diamonds.toFixed(4)} üíé</div>
                    </div>
                `;
                leaderboardList.appendChild(div);
            });
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–µ—Å—Ç–æ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const allPlayers = [...randomPlayers, { username: currentUser.username, diamonds: currentUser.diamonds }]
                .sort((a, b) => b.diamonds - a.diamonds);
            
            const userRank = allPlayers.findIndex(p => p.username === currentUser.username) + 1;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            document.getElementById('user-rank-number').textContent = `#${userRank}`;
            document.getElementById('user-rank-name').textContent = currentUser.username;
            document.getElementById('user-rank-diamonds').textContent = `${currentUser.diamonds.toFixed(4)} üíé`;
        }

        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {
                const r = Math.random() * 16 | 0;
                return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);
            });
        }
    </script>
</body>
</html>
