<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>–ò–≥—Ä–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .phone-frame {
            position: relative;
            width: 360px;
            height: 740px;
            background: #000;
            border-radius: 40px;
            padding: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }
        .phone-screen {
            width: 100%;
            height: 100%;
            background: #1a1a1a;
            border-radius: 20px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        .phone-frame::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 5px;
            background: #333;
            border-radius: 5px;
        }
        .phone-frame::after {
            content: '';
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 40px;
            background: #333;
            border-radius: 50%;
            border: 2px solid #555;
        }
        .diamond-panel {
            background: #2d3748;
            padding: 4px 8px;
            border-radius: 12px;
        }
        .notification-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background: #dc2626;
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 12px;
            line-height: 1;
        }
        .enter-animation {
            animation: enterAnimation 0.5s ease-in-out forwards;
        }
        .exit-animation {
            animation: exitAnimation 0.5s ease-in-out forwards;
        }
        .notifications-slide-down {
            animation: slideDown 0.5s ease-in-out forwards;
        }
        .notifications-slide-up {
            animation: slideUp 0.5s ease-in-out forwards;
        }
        @keyframes enterAnimation {
            0% { transform: scale(1) translate(0, 0); opacity: 1; }
            100% { transform: scale(0.2) translate(-100px, -100px); opacity: 0; }
        }
        @keyframes exitAnimation {
            0% { transform: scale(0.2) translate(-100px, -100px); opacity: 0; }
            100% { transform: scale(1) translate(0, 0); opacity: 1; }
        }
        @keyframes slideDown {
            0% { transform: translateY(-100%); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        @keyframes slideUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-100%); opacity: 0; }
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen w-screen overflow-x-hidden">
    <div class="phone-frame">
        <div class="phone-screen">
            <div id="app" class="w-full p-4 sm:p-6">
                <!-- Loading Screen -->
                <div id="loading-screen" class="flex flex-col items-center justify-center h-screen">
                    <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-blue-500"></div>
                    <p class="mt-4 text-lg">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                </div>

                <!-- Registration Screen -->
                <div id="registration-screen" class="hidden flex-col space-y-4">
                    <h1 class="text-2xl font-bold text-center">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h1>
                    <input id="phone" type="tel" placeholder="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞" class="w-full p-2 bg-gray-800 rounded text-white text-base">
                    <input id="email" type="email" placeholder="–ü–æ—á—Ç–∞" class="w-full p-2 bg-gray-800 rounded text-white text-base">
                    <input id="ff-id" type="text" placeholder="Free Fire ID" class="w-full p-2 bg-gray-800 rounded text-white text-base">
                    <input id="password" type="password" placeholder="–ü–∞—Ä–æ–ª—å" class="w-full p-2 bg-gray-800 rounded text-white text-base">
                    <button id="register-btn" class="w-full p-2 bg-blue-600 rounded hover:bg-blue-700">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                </div>

                <!-- Main Menu -->
                <div id="main-menu" class="hidden flex-col space-y-4">
                    <div class="flex justify-between items-center">
                        <div class="flex space-x-2">
                            <button id="profile-btn" class="p-2 bg-gray-800 rounded-full hover:bg-gray-700">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                </svg>
                            </button>
                            <button id="notifications-btn" class="relative p-2 bg-gray-800 rounded-full hover:bg-gray-700">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6 6 0 00-12 0v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                                </svg>
                                <span id="notification-badge" class="notification-badge hidden">0</span>
                            </button>
                        </div>
                        <div class="diamond-panel">
                            <p id="diamond-balance" class="text-lg">0.0000 üíé</p>
                        </div>
                    </div>
                    <button id="farm-btn" class="w-full p-2 bg-green-600 rounded hover:bg-green-700">–§–∞—Ä–º–∏—Ç—å üíé</button>
                    <button id="guild-btn" class="w-full p-2 bg-purple-600 rounded hover:bg-purple-700">–ì–∏–ª—å–¥–∏—è</button>
                    <button id="admin-btn" class="w-full p-2 bg-red-600 rounded hover:bg-red-700 hidden">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</button>
                </div>

                <!-- Farming Screen -->
                <div id="farm-screen" class="hidden flex-col space-y-4">
                    <h1 class="text-2xl font-bold text-center">–§–∞—Ä–º üíé</h1>
                    <p id="diamond-count" class="text-lg text-center">0.0000 üíé</p>
                    <p id="tap-count" class="text-lg text-center">–¢–∞–ø—ã: 0/100</p>
                    <p id="cooldown" class="text-lg text-center hidden">–û—Å—Ç–∞–ª–æ—Å—å: 4—á 00–º 00—Å</p>
                    <button id="tap-btn" class="w-32 h-32 mx-auto bg-gray-800 rounded-full flex justify-center items-center">
                        <img id="tap-image" src="https://i.ibb.co/1f4hYDt/Chat-GPT-Image-24-2025-04-14-46.png" alt="Garena Logo" class="h-24 w-24 object-contain">
                    </button>
                    <button id="back-btn" class="w-full p-2 bg-blue-600 rounded hover:bg-blue-700">–ù–∞–∑–∞–¥</button>
                </div>

                <!-- Profile Screen -->
                <div id="profile-screen" class="hidden flex-col space-y-4">
                    <h1 class="text-2xl font-bold text-center">–ü—Ä–æ—Ñ–∏–ª—å</h1>
                    <p id="profile-username" class="text-lg"></p>
                    <p id="profile-phone" class="text-lg"></p>
                    <p id="profile-email" class="text-lg"></p>
                    <p id="profile-ff-id" class="text-lg"></p>
                    <p id="profile-password" class="text-lg"></p>
                    <p id="profile-diamonds" class="text-lg"></p>
                    <button id="delete-account-btn" class="w-full p-2 bg-red-600 rounded hover:bg-red-700">–£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
                    <button id="profile-back-btn" class="w-full p-2 bg-blue-600 rounded hover:bg-blue-700">–ù–∞–∑–∞–¥</button>
                </div>

                <!-- Notifications Screen -->
                <div id="notifications-screen" class="hidden flex-col space-y-4">
                    <h1 class="text-2xl font-bold text-center">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h1>
                    <div id="notifications-list" class="flex-col space-y-2"></div>
                    <button id="clear-notifications-btn" class="w-full p-2 bg-red-600 rounded hover:bg-red-700">–û—á–∏—Å—Ç–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</button>
                    <button id="notifications-back-btn" class="w-full p-2 bg-blue-600 rounded hover:bg-blue-700">–ù–∞–∑–∞–¥</button>
                </div>

                <!-- Guild Screen -->
                <div id="guild-screen" class="hidden flex-col space-y-4">
                    <h1 class="text-2xl font-bold text-center">–ì–∏–ª—å–¥–∏—è</h1>
                    <p id="guild-status" class="text-lg text-center"></p>
                    <div id="create-guild-section" class="flex-col space-y-2">
                        <input id="guild-name" type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≥–∏–ª—å–¥–∏–∏" class="w-full p-2 bg-gray-800 rounded text-white text-base">
                        <button id="create-guild-btn" class="w-full p-2 bg-purple-600 rounded hover:bg-purple-700">–°–æ–∑–¥–∞—Ç—å –≥–∏–ª—å–¥–∏—é (10 üíé)</button>
                    </div>
                    <div id="join-guild-section" class="flex-col space-y-2">
                        <select id="guild-select" class="w-full p-2 bg-gray-800 rounded text-white text-base"></select>
                        <button id="join-guild-btn" class="w-full p-2 bg-blue-600 rounded hover:bg-blue-700">–ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É</button>
                    </div>
                    <button id="guild-members-btn" class="w-full p-2 bg-gray-600 rounded hover:bg-gray-700">–£—á–∞—Å—Ç–Ω–∏–∫–∏</button>
                    <button id="leave-guild-btn" class="w-full p-2 bg-red-600 rounded hover:bg-red-700 hidden">–ü–æ–∫–∏–Ω—É—Ç—å –≥–∏–ª—å–¥–∏—é</button>
                    <button id="disband-guild-btn" class="w-full p-2 bg-red-600 rounded hover:bg-red-700 hidden">–†–∞—Å–ø—É—Å—Ç–∏—Ç—å –≥–∏–ª—å–¥–∏—é</button>
                    <button id="guild-requests-btn" class="w-full p-2 bg-blue-600 rounded hover:bg-blue-700 hidden">–ó–∞—è–≤–∫–∏ –Ω–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ</button>
                    <button id="guild-back-btn" class="w-full p-2 bg-blue-600 rounded hover:bg-blue-700">–ù–∞–∑–∞–¥</button>
                </div>

                <!-- Guild Members Screen -->
                <div id="guild-members-screen" class="hidden flex-col space-y-4">
                    <h1 class="text-2xl font-bold text-center">–£—á–∞—Å—Ç–Ω–∏–∫–∏ –≥–∏–ª—å–¥–∏–∏</h1>
                    <div id="guild-members-list" class="flex-col space-y-2"></div>
                    <button id="members-back-btn" class="w-full p-2 bg-blue-600 rounded hover:bg-blue-700">–ù–∞–∑–∞–¥</button>
                </div>

                <!-- Guild Requests Screen -->
                <div id="guild-requests-screen" class="hidden flex-col space-y-4">
                    <h1 class="text-2xl font-bold text-center">–ó–∞—è–≤–∫–∏ –Ω–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ</h1>
                    <div id="guild-requests-list" class="flex-col space-y-2"></div>
                    <button id="requests-back-btn" class="w-full p-2 bg-blue-600 rounded hover:bg-blue-700">–ù–∞–∑–∞–¥</button>
                </div>

                <!-- Admin Panel Main Screen -->
                <div id="admin-panel" class="hidden flex-col space-y-4">
                    <h1 class="text-2xl font-bold text-center">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
                    <button id="admin-users-btn" class="w-full p-2 bg-blue-600 rounded hover:bg-blue-700">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
                    <button id="admin-guilds-btn" class="w-full p-2 bg-purple-600 rounded hover:bg-purple-700">–ì–∏–ª—å–¥–∏–∏</button>
                    <button id="clear-db-btn" class="w-full p-2 bg-red-600 rounded hover:bg-red-700">–û—á–∏—Å—Ç–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö</button>
                    <button id="admin-back-btn" class="w-full p-2 bg-blue-600 rounded hover:bg-blue-700">–ù–∞–∑–∞–¥</button>
                </div>

                <!-- Admin Users Screen -->
                <div id="admin-users-screen" class="hidden flex-col space-y-4">
                    <h1 class="text-2xl font-bold text-center">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h1>
                    <select id="user-select" class="w-full p-2 bg-gray-800 rounded text-white text-base"></select>
                    <div id="user-details" class="flex-col space-y-2">
                        <input id="admin-username" type="text" class="w-full p-2 bg-gray-800 rounded text-white text-base" placeholder="–ù–∏–∫–Ω–µ–π–º Telegram" disabled>
                        <input id="admin-phone" type="tel" class="w-full p-2 bg-gray-800 rounded text-white text-base" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω">
                        <input id="admin-email" type="email" class="w-full p-2 bg-gray-800 rounded text-white text-base" placeholder="–ü–æ—á—Ç–∞">
                        <input id="admin-ff-id" type="text" class="w-full p-2 bg-gray-800 rounded text-white text-base" placeholder="Free Fire ID">
                        <input id="admin-password" type="text" class="w-full p-2 bg-gray-800 rounded text-white text-base" placeholder="–ü–∞—Ä–æ–ª—å">
                        <input id="admin-diamonds" type="number" step="0.0001" class="w-full p-2 bg-gray-800 rounded text-white text-base" placeholder="–ë–∞–ª–∞–Ω—Å üíé">
                        <button id="save-user-btn" class="w-full p-2 bg-blue-600 rounded hover:bg-blue-700">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    </div>
                    <button id="admin-users-back-btn" class="w-full p-2 bg-blue-600 rounded hover:bg-blue-700">–ù–∞–∑–∞–¥</button>
                </div>

                <!-- Admin Guilds Screen -->
                <div id="admin-guilds-screen" class="hidden flex-col space-y-4">
                    <h1 class="text-2xl font-bold text-center">–ì–∏–ª—å–¥–∏–∏</h1>
                    <select id="guild-select-admin" class="w-full p-2 bg-gray-800 rounded text-white text-base"></select>
                    <div id="guild-details" class="flex-col space-y-2">
                        <input id="admin-guild-name" type="text" class="w-full p-2 bg-gray-800 rounded text-white text-base" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≥–∏–ª—å–¥–∏–∏">
                        <select id="admin-guild-leader" class="w-full p-2 bg-gray-800 rounded text-white text-base"></select>
                        <div id="admin-guild-members" class="flex-col space-y-1"></div>
                        <div id="admin-guild-requests" class="flex-col space-y-2"></div>
                        <button id="delete-guild-btn" class="w-full p-2 bg-red-600 rounded hover:bg-red-700">–£–¥–∞–ª–∏—Ç—å –≥–∏–ª—å–¥–∏—é</button>
                        <button id="save-guild-btn" class="w-full p-2 bg-blue-600 rounded hover:bg-blue-700">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    </div>
                    <button id="admin-guilds-back-btn" class="w-full p-2 bg-blue-600 rounded hover:bg-blue-700">–ù–∞–∑–∞–¥</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const TelegramWebApp = window.Telegram.WebApp;
        TelegramWebApp.ready();

        // State
        let currentUserId = null;
        let users = JSON.parse(localStorage.getItem('users')) || [];
        let guilds = JSON.parse(localStorage.getItem('guilds')) || [];
        let notifications = JSON.parse(localStorage.getItem('notifications')) || [];

        // DOM Elements
        const loadingScreen = document.getElementById('loading-screen');
        const registrationScreen = document.getElementById('registration-screen');
        const mainMenu = document.getElementById('main-menu');
        const farmScreen = document.getElementById('farm-screen');
        const profileScreen = document.getElementById('profile-screen');
        const notificationsScreen = document.getElementById('notifications-screen');
        const guildScreen = document.getElementById('guild-screen');
        const guildMembersScreen = document.getElementById('guild-members-screen');
        const guildRequestsScreen = document.getElementById('guild-requests-screen');
        const adminPanel = document.getElementById('admin-panel');
        const adminUsersScreen = document.getElementById('admin-users-screen');
        const adminGuildsScreen = document.getElementById('admin-guilds-screen');
        const registerBtn = document.getElementById('register-btn');
        const farmBtn = document.getElementById('farm-btn');
        const guildBtn = document.getElementById('guild-btn');
        const profileBtn = document.getElementById('profile-btn');
        const notificationsBtn = document.getElementById('notifications-btn');
        const notificationBadge = document.getElementById('notification-badge');
        const adminBtn = document.getElementById('admin-btn');
        const tapBtn = document.getElementById('tap-btn');
        const backBtn = document.getElementById('back-btn');
        const profileBackBtn = document.getElementById('profile-back-btn');
        const notificationsBackBtn = document.getElementById('notifications-back-btn');
        const guildBackBtn = document.getElementById('guild-back-btn');
        const membersBackBtn = document.getElementById('members-back-btn');
        const requestsBackBtn = document.getElementById('requests-back-btn');
        const adminBackBtn = document.getElementById('admin-back-btn');
        const adminUsersBtn = document.getElementById('admin-users-btn');
        const adminGuildsBtn = document.getElementById('admin-guilds-btn');
        const adminUsersBackBtn = document.getElementById('admin-users-back-btn');
        const adminGuildsBackBtn = document.getElementById('admin-guilds-back-btn');
        const deleteAccountBtn = document.getElementById('delete-account-btn');
        const diamondCount = document.getElementById('diamond-count');
        const tapCount = document.getElementById('tap-count');
        const cooldown = document.getElementById('cooldown');
        const diamondBalance = document.getElementById('diamond-balance');
        const guildStatus = document.getElementById('guild-status');
        const guildNameInput = document.getElementById('guild-name');
        const createGuildBtn = document.getElementById('create-guild-btn');
        const guildSelect = document.getElementById('guild-select');
        const joinGuildBtn = document.getElementById('join-guild-btn');
        const guildMembersBtn = document.getElementById('guild-members-btn');
        const leaveGuildBtn = document.getElementById('leave-guild-btn');
        const disbandGuildBtn = document.getElementById('disband-guild-btn');
        const guildRequestsBtn = document.getElementById('guild-requests-btn');
        const guildMembersList = document.getElementById('guild-members-list');
        const guildRequestsList = document.getElementById('guild-requests-list');
        const notificationsList = document.getElementById('notifications-list');
        const clearNotificationsBtn = document.getElementById('clear-notifications-btn');
        const userSelect = document.getElementById('user-select');
        const adminUsername = document.getElementById('admin-username');
        const adminPhone = document.getElementById('admin-phone');
        const adminEmail = document.getElementById('admin-email');
        const adminFfId = document.getElementById('admin-ff-id');
        const adminPassword = document.getElementById('admin-password');
        const adminDiamonds = document.getElementById('admin-diamonds');
        const saveUserBtn = document.getElementById('save-user-btn');
        const guildSelectAdmin = document.getElementById('guild-select-admin');
        const adminGuildName = document.getElementById('admin-guild-name');
        const adminGuildLeader = document.getElementById('admin-guild-leader');
        const adminGuildMembers = document.getElementById('admin-guild-members');
        const adminGuildRequests = document.getElementById('admin-guild-requests');
        const saveGuildBtn = document.getElementById('save-guild-btn');
        const deleteGuildBtn = document.getElementById('delete-guild-btn');
        const clearDbBtn = document.getElementById('clear-db-btn');

        // Get Telegram user data
        const telegramUser = TelegramWebApp.initDataUnsafe.user;
        let telegramUsername = telegramUser ? (telegramUser.username || telegramUser.id.toString()) : 'Unknown';

        // Always show loading screen on page load
        setTimeout(() => {
            currentUserId = localStorage.getItem('currentUserId');
            if (currentUserId && users.find(u => u.id === currentUserId)) {
                showMainMenu();
            } else {
                loadingScreen.classList.add('hidden');
                registrationScreen.classList.remove('hidden');
            }
        }, 2000);

        // Registration
        registerBtn.addEventListener('click', () => {
            const phone = document.getElementById('phone').value;
            const email = document.getElementById('email').value;
            const ffId = document.getElementById('ff-id').value;
            const password = document.getElementById('password').value;
            if (phone && email && ffId && password) {
                const user = {
                    id: generateUUID(),
                    telegramId: telegramUser ? telegramUser.id : null,
                    username: telegramUsername,
                    phone,
                    email,
                    ffId,
                    password,
                    diamonds: 0,
                    taps: 0,
                    lastTapTime: null,
                    guildId: null
                };
                users.push(user);
                currentUserId = user.id;
                localStorage.setItem('users', JSON.stringify(users));
                localStorage.setItem('currentUserId', currentUserId);
                showMainMenu();
            } else {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
            }
        });

        // Navigation
        farmBtn.addEventListener('click', () => {
            mainMenu.classList.add('enter-animation');
            setTimeout(() => {
                mainMenu.classList.add('hidden');
                mainMenu.classList.remove('enter-animation');
                farmScreen.classList.remove('hidden');
                updateFarmScreen();
            }, 500);
        });

        profileBtn.addEventListener('click', () => {
            mainMenu.classList.add('enter-animation');
            setTimeout(() => {
                mainMenu.classList.add('hidden');
                mainMenu.classList.remove('enter-animation');
                profileScreen.classList.remove('hidden');
                updateProfileScreen();
            }, 500);
        });

        notificationsBtn.addEventListener('click', () => {
            mainMenu.classList.add('enter-animation');
            setTimeout(() => {
                mainMenu.classList.add('hidden');
                mainMenu.classList.remove('enter-animation');
                notificationsScreen.classList.remove('hidden');
                notificationsScreen.classList.add('notifications-slide-down');
                setTimeout(() => {
                    notificationsScreen.classList.remove('notifications-slide-down');
                }, 500);
                updateNotificationsScreen();
            }, 500);
        });

        guildBtn.addEventListener('click', () => {
            mainMenu.classList.add('enter-animation');
            setTimeout(() => {
                mainMenu.classList.add('hidden');
                mainMenu.classList.remove('enter-animation');
                guildScreen.classList.remove('hidden');
                updateGuildScreen();
            }, 500);
        });

        adminBtn.addEventListener('click', () => {
            mainMenu.classList.add('enter-animation');
            setTimeout(() => {
                mainMenu.classList.add('hidden');
                mainMenu.classList.remove('enter-animation');
                adminPanel.classList.remove('hidden');
            }, 500);
        });

        adminUsersBtn.addEventListener('click', () => {
            adminPanel.classList.add('enter-animation');
            setTimeout(() => {
                adminPanel.classList.add('hidden');
                adminPanel.classList.remove('enter-animation');
                adminUsersScreen.classList.remove('hidden');
                updateAdminUsersScreen();
            }, 500);
        });

        adminGuildsBtn.addEventListener('click', () => {
            adminPanel.classList.add('enter-animation');
            setTimeout(() => {
                adminPanel.classList.add('hidden');
                adminPanel.classList.remove('enter-animation');
                adminGuildsScreen.classList.remove('hidden');
                updateAdminGuildsScreen();
            }, 500);
        });

        backBtn.addEventListener('click', () => {
            farmScreen.classList.add('exit-animation');
            setTimeout(() => {
                farmScreen.classList.add('hidden');
                farmScreen.classList.remove('exit-animation');
                showMainMenu();
            }, 500);
        });

        profileBackBtn.addEventListener('click', () => {
            profileScreen.classList.add('exit-animation');
            setTimeout(() => {
                profileScreen.classList.add('hidden');
                profileScreen.classList.remove('exit-animation');
                showMainMenu();
            }, 500);
        });

        notificationsBackBtn.addEventListener('click', () => {
            notificationsScreen.classList.add('notifications-slide-up');
            setTimeout(() => {
                notificationsScreen.classList.add('hidden');
                notificationsScreen.classList.remove('notifications-slide-up');
                showMainMenu();
            }, 500);
        });

        guildBackBtn.addEventListener('click', () => {
            guildScreen.classList.add('exit-animation');
            setTimeout(() => {
                guildScreen.classList.add('hidden');
                guildScreen.classList.remove('exit-animation');
                showMainMenu();
            }, 500);
        });

        membersBackBtn.addEventListener('click', () => {
            guildMembersScreen.classList.add('exit-animation');
            setTimeout(() => {
                guildMembersScreen.classList.add('hidden');
                guildMembersScreen.classList.remove('exit-animation');
                guildScreen.classList.remove('hidden');
                updateGuildScreen();
            }, 500);
        });

        requestsBackBtn.addEventListener('click', () => {
            guildRequestsScreen.classList.add('exit-animation');
            setTimeout(() => {
                guildRequestsScreen.classList.add('hidden');
                guildRequestsScreen.classList.remove('exit-animation');
                guildScreen.classList.remove('hidden');
                updateGuildScreen();
            }, 500);
        });

        adminBackBtn.addEventListener('click', () => {
            adminPanel.classList.add('exit-animation');
            setTimeout(() => {
                adminPanel.classList.add('hidden');
                adminPanel.classList.remove('exit-animation');
                showMainMenu();
            }, 500);
        });

        adminUsersBackBtn.addEventListener('click', () => {
            adminUsersScreen.classList.add('exit-animation');
            setTimeout(() => {
                adminUsersScreen.classList.add('hidden');
                adminUsersScreen.classList.remove('exit-animation');
                adminPanel.classList.remove('hidden');
            }, 500);
        });

        adminGuildsBackBtn.addEventListener('click', () => {
            adminGuildsScreen.classList.add('exit-animation');
            setTimeout(() => {
                adminGuildsScreen.classList.add('hidden');
                adminGuildsScreen.classList.remove('exit-animation');
                adminPanel.classList.remove('hidden');
            }, 500);
        });

        // Delete Account
        deleteAccountBtn.addEventListener('click', () => {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç?')) {
                const user = users.find(u => u.id === currentUserId);
                if (user.guildId) {
                    const guild = guilds.find(g => g.id === user.guildId);
                    if (guild.leaderId === currentUserId) {
                        guilds = guilds.filter(g => g.id !== user.guildId);
                        users.forEach(u => {
                            if (u.guildId === user.guildId && u.id !== currentUserId) {
                                u.guildId = null;
                                notifications.push({
                                    id: generateUUID(),
                                    userId: u.id,
                                    message: `–ì–∏–ª—å–¥–∏—è ${guild.name} —Ä–∞—Å–ø—É—â–µ–Ω–∞ –ª–∏–¥–µ—Ä–æ–º`,
                                    timestamp: new Date().toLocaleString()
                                });
                            }
                        });
                    } else {
                        guild.members = guild.members.filter(m => m !== currentUserId);
                        guild.requests = guild.requests.filter(r => r !== currentUserId);
                    }
                }
                users = users.filter(u => u.id !== currentUserId);
                notifications = notifications.filter(n => n.userId !== currentUserId);
                localStorage.setItem('users', JSON.stringify(users));
                localStorage.setItem('guilds', JSON.stringify(guilds));
                localStorage.setItem('notifications', JSON.stringify(notifications));
                localStorage.removeItem('currentUserId');
                currentUserId = null;
                loadingScreen.classList.remove('hidden');
                mainMenu.classList.add('hidden');
                profileScreen.classList.add('hidden');
                setTimeout(() => {
                    loadingScreen.classList.add('hidden');
                    registrationScreen.classList.remove('hidden');
                }, 1000);
            }
        });

        // Farming Logic
        tapBtn.addEventListener('click', () => {
            const user = users.find(u => u.id === currentUserId);
            const now = Date.now();
            if (!user.lastTapTime || now - user.lastTapTime >= 4 * 60 * 60 * 1000) {
                user.taps = 0;
                user.lastTapTime = now;
            }

            if (user.taps < 100) {
                user.taps++;
                user.diamonds += 0.0001;
                localStorage.setItem('users', JSON.stringify(users));
                updateFarmScreen();
                updateDiamondBalance();
            } else {
                tapBtn.disabled = true;
                cooldown.classList.remove('hidden');
                startCooldown();
            }
        });

        // Notifications Logic
        clearNotificationsBtn.addEventListener('click', () => {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è?')) {
                notifications = notifications.filter(n => n.userId !== currentUserId);
                localStorage.setItem('notifications', JSON.stringify(notifications));
                updateNotificationsScreen();
                updateNotificationBadge();
            }
        });

        // Guild Logic
        createGuildBtn.addEventListener('click', () => {
            const user = users.find(u => u.id === currentUserId);
            const guildName = guildNameInput.value.trim();
            if (!guildName) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–∏–ª—å–¥–∏–∏!');
                return;
            }
            if (user.diamonds < 10) {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∞–ª–º–∞–∑–æ–≤! –ù—É–∂–Ω–æ 10 üíé');
                return;
            }
            if (user.guildId) {
                alert('–í—ã —É–∂–µ —Å–æ—Å—Ç–æ–∏—Ç–µ –≤ –≥–∏–ª—å–¥–∏–∏!');
                return;
            }
            user.diamonds -= 10;
            user.guildId = generateUUID();
            const newGuild = {
                id: user.guildId,
                name: guildName,
                leaderId: currentUserId,
                members: [currentUserId],
                requests: []
            };
            guilds.push(newGuild);
            localStorage.setItem('users', JSON.stringify(users));
            localStorage.setItem('guilds', JSON.stringify(guilds));
            updateGuildScreen();
            updateDiamondBalance();
            alert('–ì–∏–ª—å–¥–∏—è —Å–æ–∑–¥–∞–Ω–∞!');
        });

        joinGuildBtn.addEventListener('click', () => {
            const user = users.find(u => u.id === currentUserId);
            const selectedGuildId = guildSelect.value;
            if (!selectedGuildId) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ –≥–∏–ª—å–¥–∏—é!');
                return;
            }
            if (user.guildId) {
                alert('–í—ã —É–∂–µ —Å–æ—Å—Ç–æ–∏—Ç–µ –≤ –≥–∏–ª—å–¥–∏–∏!');
                return;
            }
            const guild = guilds.find(g => g.id === selectedGuildId);
            if (!guild.requests.includes(currentUserId)) {
                guild.requests.push(currentUserId);
                notifications.push({
                    id: generateUUID(),
                    userId: guild.leaderId,
                    message: `–ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ –Ω–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ –æ—Ç ${user.username}`,
                    timestamp: new Date().toLocaleString()
                });
                localStorage.setItem('guilds', JSON.stringify(guilds));
                localStorage.setItem('notifications', JSON.stringify(notifications));
                alert('–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–∏–¥–µ—Ä—É –≥–∏–ª—å–¥–∏–∏!');
            } else {
                alert('–ó–∞—è–≤–∫–∞ —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!');
            }
            updateGuildScreen();
            updateNotificationBadge();
        });

        guildMembersBtn.addEventListener('click', () => {
            guildScreen.classList.add('hidden');
            guildMembersScreen.classList.remove('hidden');
            updateGuildMembersScreen();
        });

        leaveGuildBtn.addEventListener('click', () => {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø–æ–∫–∏–Ω—É—Ç—å –≥–∏–ª—å–¥–∏—é?')) {
                const user = users.find(u => u.id === currentUserId);
                const guild = guilds.find(g => g.id === user.guildId);
                guild.members = guild.members.filter(m => m !== currentUserId);
                guild.requests = guild.requests.filter(r => r !== currentUserId);
                user.guildId = null;
                localStorage.setItem('users', JSON.stringify(users));
                localStorage.setItem('guilds', JSON.stringify(guilds));
                updateGuildScreen();
                alert('–í—ã –ø–æ–∫–∏–Ω—É–ª–∏ –≥–∏–ª—å–¥–∏—é!');
            }
        });

        disbandGuildBtn.addEventListener('click', () => {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Ä–∞—Å–ø—É—Å—Ç–∏—Ç—å –≥–∏–ª—å–¥–∏—é?')) {
                const user = users.find(u => u.id === currentUserId);
                const guild = guilds.find(g => g.id === user.guildId);
                users.forEach(u => {
                    if (u.guildId === guild.id && u.id !== currentUserId) {
                        u.guildId = null;
                        notifications.push({
                            id: generateUUID(),
                            userId: u.id,
                            message: `–ì–∏–ª—å–¥–∏—è ${guild.name} —Ä–∞—Å–ø—É—â–µ–Ω–∞ –ª–∏–¥–µ—Ä–æ–º`,
                            timestamp: new Date().toLocaleString()
                        });
                    }
                });
                guilds = guilds.filter(g => g.id !== guild.id);
                user.guildId = null;
                localStorage.setItem('users', JSON.stringify(users));
                localStorage.setItem('guilds', JSON.stringify(guilds));
                localStorage.setItem('notifications', JSON.stringify(notifications));
                updateGuildScreen();
                updateNotificationBadge();
                alert('–ì–∏–ª—å–¥–∏—è —Ä–∞—Å–ø—É—â–µ–Ω–∞!');
            }
        });

        guildRequestsBtn.addEventListener('click', () => {
            guildScreen.classList.add('hidden');
            guildRequestsScreen.classList.remove('hidden');
            updateGuildRequestsScreen();
        });

        // Admin Users Logic
        userSelect.addEventListener('change', () => {
            const selectedUserId = userSelect.value;
            const user = users.find(u => u.id === selectedUserId);
            if (user) {
                adminUsername.value = user.username;
                adminPhone.value = user.phone;
                adminEmail.value = user.email;
                adminFfId.value = user.ffId;
                adminPassword.value = user.password;
                adminDiamonds.value = user.diamonds.toFixed(4);
            }
        });

        saveUserBtn.addEventListener('click', () => {
            const selectedUserId = userSelect.value;
            const user = users.find(u => u.id === selectedUserId);
            if (user) {
                const newPhone = adminPhone.value;
                const newEmail = adminEmail.value;
                const newFfId = adminFfId.value;
                const newPassword = adminPassword.value;
                const newDiamonds = parseFloat(adminDiamonds.value);
                if (newPhone && newEmail && newFfId && newPassword && !isNaN(newDiamonds) && newDiamonds >= 0) {
                    user.phone = newPhone;
                    user.email = newEmail;
                    user.ffId = newFfId;
                    user.password = newPassword;
                    user.diamonds = newDiamonds;
                    localStorage.setItem('users', JSON.stringify(users));
                    alert('–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω—ã!');
                    if (selectedUserId === currentUserId) {
                        updateDiamondBalance();
                        updateFarmScreen();
                        updateProfileScreen();
                    }
                } else {
                    alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!');
                }
            }
        });

        // Admin Guilds Logic
        guildSelectAdmin.addEventListener('change', () => {
            updateAdminGuildsScreen();
        });

        saveGuildBtn.addEventListener('click', () => {
            const selectedGuildId = guildSelectAdmin.value;
            const guild = guilds.find(g => g.id === selectedGuildId);
            if (guild) {
                const newName = adminGuildName.value.trim();
                const newLeaderId = adminGuildLeader.value;
                if (!newName) {
                    alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–∏–ª—å–¥–∏–∏!');
                    return;
                }
                if (!newLeaderId) {
                    alert('–í—ã–±–µ—Ä–∏—Ç–µ –ª–∏–¥–µ—Ä–∞!');
                    return;
                }
                guild.name = newName;
                if (guild.leaderId !== newLeaderId) {
                    if (!guild.members.includes(newLeaderId)) {
                        alert('–ù–æ–≤—ã–π –ª–∏–¥–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–º –≥–∏–ª—å–¥–∏–∏!');
                        return;
                    }
                    guild.leaderId = newLeaderId;
                    notifications.push({
                        id: generateUUID(),
                        userId: newLeaderId,
                        message: `–í—ã –Ω–∞–∑–Ω–∞—á–µ–Ω—ã –ª–∏–¥–µ—Ä–æ–º –≥–∏–ª—å–¥–∏–∏ ${guild.name}`,
                        timestamp: new Date().toLocaleString()
                    });
                    localStorage.setItem('notifications', JSON.stringify(notifications));
                    updateNotificationBadge();
                }
                localStorage.setItem('guilds', JSON.stringify(guilds));
                alert('–î–∞–Ω–Ω—ã–µ –≥–∏–ª—å–¥–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!');
                updateAdminGuildsScreen();
            }
        });

        deleteGuildBtn.addEventListener('click', () => {
            const selectedGuildId = guildSelectAdmin.value;
            if (!selectedGuildId) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ –≥–∏–ª—å–¥–∏—é!');
                return;
            }
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≥–∏–ª—å–¥–∏—é?')) {
                const guild = guilds.find(g => g.id === selectedGuildId);
                users.forEach(u => {
                    if (u.guildId === guild.id) {
                        u.guildId = null;
                        notifications.push({
                            id: generateUUID(),
                            userId: u.id,
                            message: `–ì–∏–ª—å–¥–∏—è ${guild.name} —É–¥–∞–ª–µ–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º`,
                            timestamp: new Date().toLocaleString()
                        });
                    }
                });
                guilds = guilds.filter(g => g.id !== selectedGuildId);
                localStorage.setItem('users', JSON.stringify(users));
                localStorage.setItem('guilds', JSON.stringify(guilds));
                localStorage.setItem('notifications', JSON.stringify(notifications));
                updateAdminGuildsScreen();
                updateNotificationBadge();
                alert('–ì–∏–ª—å–¥–∏—è —É–¥–∞–ª–µ–Ω–∞!');
            }
        });

        clearDbBtn.addEventListener('click', () => {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö? –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –≥–∏–ª—å–¥–∏–∏ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã!')) {
                users = [];
                guilds = [];
                notifications = [];
                localStorage.setItem('users', JSON.stringify(users));
                localStorage.setItem('guilds', JSON.stringify(guilds));
                localStorage.setItem('notifications', JSON.stringify(notifications));
                localStorage.removeItem('currentUserId');
                currentUserId = null;
                loadingScreen.classList.remove('hidden');
                adminPanel.classList.add('hidden');
                setTimeout(() => {
                    loadingScreen.classList.add('hidden');
                    registrationScreen.classList.remove('hidden');
                }, 1000);
            }
        });

        function showMainMenu() {
            loadingScreen.classList.add('hidden');
            registrationScreen.classList.add('hidden');
            farmScreen.classList.add('hidden');
            profileScreen.classList.add('hidden');
            notificationsScreen.classList.add('hidden');
            guildScreen.classList.add('hidden');
            guildMembersScreen.classList.add('hidden');
            guildRequestsScreen.classList.add('hidden');
            adminPanel.classList.add('hidden');
            adminUsersScreen.classList.add('hidden');
            adminGuildsScreen.classList.add('hidden');
            mainMenu.classList.remove('hidden');
            const user = users.find(u => u.id === currentUserId);
            if (user && (user.ffId === '161686768' || user.phone === '+380689640782')) {
                adminBtn.classList.remove('hidden');
            } else {
                adminBtn.classList.add('hidden');
            }
            updateDiamondBalance();
            updateNotificationBadge();
        }

        function updateFarmScreen() {
            const user = users.find(u => u.id === currentUserId);
            diamondCount.textContent = `${user.diamonds.toFixed(4)} üíé`;
            tapCount.textContent = `–¢–∞–ø—ã: ${user.taps}/100`;
            if (user.taps >= 100) {
                tapBtn.disabled = true;
                cooldown.classList.remove('hidden');
                startCooldown();
            } else {
                tapBtn.disabled = false;
                cooldown.classList.add('hidden');
            }
        }

        function updateProfileScreen() {
            const user = users.find(u => u.id === currentUserId);
            document.getElementById('profile-username').textContent = `–ù–∏–∫–Ω–µ–π–º Telegram: ${user.username}`;
            document.getElementById('profile-phone').textContent = `–¢–µ–ª–µ—Ñ–æ–Ω: ${user.phone}`;
            document.getElementById('profile-email').textContent = `–ü–æ—á—Ç–∞: ${user.email}`;
            document.getElementById('profile-ff-id').textContent = `Free Fire ID: ${user.ffId}`;
            document.getElementById('profile-password').textContent = `–ü–∞—Ä–æ–ª—å: ${user.password}`;
            document.getElementById('profile-diamonds').textContent = `–ë–∞–ª–∞–Ω—Å: ${user.diamonds.toFixed(4)} üíé`;
        }

        function updateNotificationsScreen() {
            notificationsList.innerHTML = '';
            const userNotifications = notifications.filter(n => n.userId === currentUserId);
            if (userNotifications.length === 0) {
                notificationsList.innerHTML = '<p class="text-lg text-center">–ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</p>';
            } else {
                userNotifications.forEach(notification => {
                    const p = document.createElement('p');
                    p.className = 'text-sm';
                    p.textContent = `${notification.message} (${notification.timestamp})`;
                    notificationsList.appendChild(p);
                });
            }
            updateNotificationBadge();
        }

        function updateNotificationBadge() {
            const userNotifications = notifications.filter(n => n.userId === currentUserId);
            if (userNotifications.length > 0) {
                notificationBadge.textContent = userNotifications.length;
                notificationBadge.classList.remove('hidden');
            } else {
                notificationBadge.classList.add('hidden');
            }
        }

        function updateGuildScreen() {
            const user = users.find(u => u.id === currentUserId);
            createGuildBtn.classList.add('hidden');
            guildNameInput.classList.add('hidden');
            joinGuildBtn.classList.add('hidden');
            guildSelect.classList.add('hidden');
            leaveGuildBtn.classList.add('hidden');
            disbandGuildBtn.classList.add('hidden');
            guildRequestsBtn.classList.add('hidden');
            guildMembersBtn.classList.add('hidden');

            if (user.guildId) {
                const guild = guilds.find(g => g.id === user.guildId);
                guildStatus.textContent = `–í—ã —Å–æ—Å—Ç–æ–∏—Ç–µ –≤ –≥–∏–ª—å–¥–∏–∏: ${guild.name}`;
                guildMembersBtn.classList.remove('hidden');
                if (guild.leaderId === currentUserId) {
                    disbandGuildBtn.classList.remove('hidden');
                    guildRequestsBtn.classList.remove('hidden');
                } else {
                    leaveGuildBtn.classList.remove('hidden');
                }
            } else {
                guildStatus.textContent = '–í—ã –Ω–µ —Å–æ—Å—Ç–æ–∏—Ç–µ –≤ –≥–∏–ª—å–¥–∏–∏';
                createGuildBtn.classList.remove('hidden');
                guildNameInput.classList.remove('hidden');
                joinGuildBtn.classList.remove('hidden');
                guildSelect.classList.remove('hidden');
            }

            guildSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥–∏–ª—å–¥–∏—é</option>';
            guilds.forEach(guild => {
                const option = document.createElement('option');
                option.value = guild.id;
                option.textContent = guild.name;
                guildSelect.appendChild(option);
            });
        }

        function updateGuildMembersScreen() {
            const user = users.find(u => u.id === currentUserId);
            const guild = guilds.find(g => g.id === user.guildId);
            guildMembersList.innerHTML = '';
            guild.members.forEach(memberId => {
                const member = users.find(u => u.id === memberId);
                const p = document.createElement('p');
                p.textContent = `${member.username}${memberId === guild.leaderId ? ' (–õ–∏–¥–µ—Ä)' : ''}`;
                guildMembersList.appendChild(p);
            });
        }

        function updateGuildRequestsScreen() {
            const user = users.find(u => u.id === currentUserId);
            const guild = guilds.find(g => g.id === user.guildId);
            guildRequestsList.innerHTML = '';
            guild.requests.forEach(requestId => {
                const requester = users.find(u => u.id === requestId);
                const div = document.createElement('div');
                div.className = 'flex justify-between items-center';
                div.innerHTML = `
                    <p>${requester.username}</p>
                    <div>
                        <button class="accept-request-btn p-1 bg-green-600 rounded hover:bg-green-700 text-sm" data-user-id="${requestId}">–ü—Ä–∏–Ω—è—Ç—å</button>
                        <button class="reject-request-btn p-1 bg-red-600 rounded hover:bg-red-700 text-sm" data-user-id="${requestId}">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
                    </div>
                `;
                guildRequestsList.appendChild(div);
            });

            document.querySelectorAll('.accept-request-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const userId = btn.getAttribute('data-user-id');
                    const guild = guilds.find(g => g.id === user.guildId);
                    guild.requests = guild.requests.filter(r => r !== userId);
                    guild.members.push(userId);
                    const requester = users.find(u => u.id === userId);
                    requester.guildId = guild.id;
                    notifications.push({
                        id: generateUUID(),
                        userId: userId,
                        message: `–í–∞—à–∞ –∑–∞—è–≤–∫–∞ –≤ –≥–∏–ª—å–¥–∏—é ${guild.name} –ø—Ä–∏–Ω—è—Ç–∞`,
                        timestamp: new Date().toLocaleString()
                    });
                    localStorage.setItem('users', JSON.stringify(users));
                    localStorage.setItem('guilds', JSON.stringify(guilds));
                    localStorage.setItem('notifications', JSON.stringify(notifications));
                    updateGuildRequestsScreen();
                    updateNotificationBadge();
                    alert('–ó–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞!');
                });
            });

            document.querySelectorAll('.reject-request-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const userId = btn.getAttribute('data-user-id');
                    const guild = guilds.find(g => g.id === user.guildId);
                    guild.requests = guild.requests.filter(r => r !== userId);
                    notifications.push({
                        id: generateUUID(),
                        userId: userId,
                        message: `–í–∞—à–∞ –∑–∞—è–≤–∫–∞ –≤ –≥–∏–ª—å–¥–∏—é ${guild.name} –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞`,
                        timestamp: new Date().toLocaleString()
                    });
                    localStorage.setItem('guilds', JSON.stringify(guilds));
                    localStorage.setItem('notifications', JSON.stringify(notifications));
                    updateGuildRequestsScreen();
                    updateNotificationBadge();
                    alert('–ó–∞—è–≤–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞!');
                });
            });
        }

        function updateAdminUsersScreen() {
            userSelect.innerHTML = '';
            users.forEach(user => {
                const option = document.createElement('option');
                option.value = user.id;
                option.textContent = `${user.username}`;
                userSelect.appendChild(option);
            });
            const selectedUser = users.find(u => u.id === userSelect.value);
            if (selectedUser) {
                adminUsername.value = selectedUser.username;
                adminPhone.value = selectedUser.phone;
                adminEmail.value = selectedUser.email;
                adminFfId.value = selectedUser.ffId;
                adminPassword.value = selectedUser.password;
                adminDiamonds.value = selectedUser.diamonds.toFixed(4);
            }
        }

        function updateAdminGuildsScreen() {
            guildSelectAdmin.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥–∏–ª—å–¥–∏—é</option>';
            guilds.forEach(guild => {
                const leader = users.find(u => u.id === guild.leaderId);
                const option = document.createElement('option');
                option.value = guild.id;
                option.textContent = `${guild.name} (–õ–∏–¥–µ—Ä: ${leader ? leader.username : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'})`;
                guildSelectAdmin.appendChild(option);
            });

            const selectedGuild = guilds.find(g => g.id === guildSelectAdmin.value);
            if (selectedGuild) {
                adminGuildName.value = selectedGuild.name;
                adminGuildLeader.innerHTML = '';
                selectedGuild.members.forEach(memberId => {
                    const member = users.find(u => u.id === memberId);
                    const option = document.createElement('option');
                    option.value = member.id;
                    option.textContent = `${member.username}`;
                    if (member.id === selectedGuild.leaderId) {
                        option.selected = true;
                    }
                    adminGuildLeader.appendChild(option);
                });

                adminGuildMembers.innerHTML = '';
                selectedGuild.members.forEach(memberId => {
                    const member = users.find(u => u.id === memberId);
                    const p = document.createElement('p');
                    p.textContent = `${member.username}${memberId === selectedGuild.leaderId ? ' (–õ–∏–¥–µ—Ä)' : ''}`;
                    adminGuildMembers.appendChild(p);
                });

                adminGuildRequests.innerHTML = '';
                selectedGuild.requests.forEach(requestId => {
                    const requester = users.find(u => u.id === requestId);
                    const div = document.createElement('div');
                    div.className = 'flex justify-between items-center';
                    div.innerHTML = `
                        <p>${requester.username}</p>
                        <div>
                            <button class="admin-accept-request-btn p-1 bg-green-600 rounded hover:bg-green-700 text-sm" data-user-id="${requestId}">–ü—Ä–∏–Ω—è—Ç—å</button>
                            <button class="admin-reject-request-btn p-1 bg-red-600 rounded hover:bg-red-700 text-sm" data-user-id="${requestId}">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
                        </div>
                    `;
                    adminGuildRequests.appendChild(div);
                });

                document.querySelectorAll('.admin-accept-request-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const userId = btn.getAttribute('data-user-id');
                        const guild = guilds.find(g => g.id === selectedGuild.id);
                        guild.requests = guild.requests.filter(r => r !== userId);
                        guild.members.push(userId);
                        const requester = users.find(u => u.id === userId);
                        requester.guildId = guild.id;
                        notifications.push({
                            id: generateUUID(),
                            userId: userId,
                            message: `–í–∞—à–∞ –∑–∞—è–≤–∫–∞ –≤ –≥–∏–ª—å–¥–∏—é ${guild.name} –ø—Ä–∏–Ω—è—Ç–∞`,
                            timestamp: new Date().toLocaleString()
                        });
                        localStorage.setItem('users', JSON.stringify(users));
                        localStorage.setItem('guilds', JSON.stringify(guilds));
                        localStorage.setItem('notifications', JSON.stringify(notifications));
                        updateAdminGuildsScreen();
                        updateNotificationBadge();
                        alert('–ó–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞!');
                    });
                });

                document.querySelectorAll('.admin-reject-request-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const userId = btn.getAttribute('data-user-id');
                        const guild = guilds.find(g => g.id === selectedGuild.id);
                        guild.requests = guild.requests.filter(r => r !== userId);
                        notifications.push({
                            id: generateUUID(),
                            userId: userId,
                            message: `–í–∞—à–∞ –∑–∞—è–≤–∫–∞ –≤ –≥–∏–ª—å–¥–∏—é ${guild.name} –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞`,
                            timestamp: new Date().toLocaleString()
                        });
                        localStorage.setItem('guilds', JSON.stringify(guilds));
                        localStorage.setItem('notifications', JSON.stringify(notifications));
                        updateAdminGuildsScreen();
                        updateNotificationBadge();
                        alert('–ó–∞—è–≤–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞!');
                    });
                });
            } else {
                adminGuildName.value = '';
                adminGuildLeader.innerHTML = '';
                adminGuildMembers.innerHTML = '';
                adminGuildRequests.innerHTML = '';
            }
        }

        function updateDiamondBalance() {
            const user = users.find(u => u.id === currentUserId);
            diamondBalance.textContent = `${user.diamonds.toFixed(4)} üíé`;
        }

        function startCooldown() {
            const user = users.find(u => u.id === currentUserId);
            const endTime = user.lastTapTime + 4 * 60 * 60 * 1000;
            const interval = setInterval(() => {
                const now = Date.now();
                const timeLeft = endTime - now;
                if (timeLeft <= 0) {
                    user.taps = 0;
                    localStorage.setItem('users', JSON.stringify(users));
                    updateFarmScreen();
                    clearInterval(interval);
                } else {
                    const hours = Math.floor(timeLeft / (1000 * 60 * 60));
                    const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
                    cooldown.textContent = `–û—Å—Ç–∞–ª–æ—Å—å: ${hours}—á ${minutes}–º ${seconds}—Å`;
                }
            }, 1000);
        }

        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {
                const r = Math.random() * 16 | 0;
                return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);
            });
        }
    </script>
</body>
</html>